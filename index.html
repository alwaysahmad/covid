
<!DOCTYPE html>
<meta charset="utf-8">
<head>
  <!--link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous"-->
  <style>
        h1{
            color:rgb(255, 255, 255);
            background-color:rgb(4, 169, 219);
        }
        .stripe{
            color:rgb(0, 238, 255);
        }
  .states {
    fill: none;
  }
  .grid .tick {
      stroke: lightgrey;
      opacity: 0.3;
  }
  .grid path {
        stroke-width: 0.5;
  }
  path {
	 	stroke:rgb(148, 147, 147);
	 	stroke-width: 1px;
	}
  .bar {
        fill: steelblue;
    }
  .statesline {
    fill: none;
    stroke:lightgray;
    stroke-linejoin: round;

  }
  /*
  .d3-tip {
    line-height: 1;
    padding: 10px;
    background: rgba(0, 0, 0, 0.8);
    color: #fff;
    border-radius: 2px;
  }*/
  .d3-tip { font-family: 'Roboto', sans-serif; font-weight: 300; padding: 12px; background: rgba(0, 0, 0, 0.8); color: #fff; border-radius: 2px; z-index: 1; pointer-events: none !important; }

  body {
        font-family:"avenir next", Arial, sans-serif;
        font-size: 14px;
        color: #696969;
        background-color:seashell;

      }
      #play-button {
        position: absolute;
        background: #f08080;
        padding-right: 26px;
        border-radius: 3px;
        border: none;
        color: white;
        margin: 0;
        padding: 0 12px;
        width: 60px;
        cursor: pointer;
        height: 20px;
      }
      #play-button:hover {
        background-color: #696969;
      }

      .ticks {
        font-size: 10px;
      }
      .track,
      .track-inset,
      .track-overlay {
        stroke-linecap: round;
      }
      .track {
        stroke: #000;
        stroke-opacity: 0.3;
        stroke-width: 10px;
      }
      .track-inset {
        stroke: #dcdcdc;
        stroke-width: 8px;
      }
      .track-overlay {
        pointer-events: stroke;
        stroke-width: 10px;
        stroke: transparent;
        cursor: crosshair;
      }
      .handle {
        fill: #fff;
        stroke: #000;
        stroke-opacity: 0.5;
        stroke-width: 1.25px;
      }
      .tile {
      shape-rendering: crispEdges;
    }
    .axis path,
    .axis line {
      fill: none;
      stroke: #000;
      shape-rendering: crispEdges;

    }
    .row {
    display: flex;
    }
    .column {
      flex: 50%;
    }/*
    .scatter-plot{
      background-color: cornsilk;
    }
    .line-plot{
      background-color: seashell;
    }*/
    /* Style the tab */
    /*
    .tab {

      overflow: hidden;
      font-weight: normal;
      background-color: lightcyan;
      font-family:"avenir next", Arial, sans-serif;
        font-size: 20px;
    }*/
    /* Style the buttons that are used to open the tab content */
    /*
    .tab button {
      background-color: inherit;
      float: left;
      border: none;
      outline: none;
      cursor: pointer;
      padding: 14px 16px;
      transition: 0.3s;
      font-family:"avenir next", Arial, sans-serif;
        font-size: 14px;
    }*/
    /* Style the tab */
  .tab {
    float: left;
    border: 1px solid #ccc;
    background-color: #f1f1f1;
    width: 10%;
    /*height: 300px;*/
  }

  /* Style the buttons that are used to open the tab content */
  .tab button {
    display: block;
    background-color: inherit;
    color: black;
    padding: 22px 16px;
    width: 100%;
    border: none;
    outline: none;
    text-align: left;
    cursor: pointer;
    transition: 0.3s;
  }
  /* Change background color of buttons on hover */
  .tablink:hover {
    background-color: #777;
  }
    /* Create an active/current tablink class */
    .tab button.active {
      background-color:skyblue;
      font-weight: bold;

    }
    /* Style the tab content */
    /*
  .tabcontent {
    display: none;
    padding: 6px 12px;
    //border: 1px solid #ccc;
    border-top: none;
  }*/
  /* Style the tab content */
  .tabcontent {
    float: left;
    padding: 0px 12px;
    /*border: 1px solid #ccc;*/
    width: 70%;
    border-left: none;
    /*height: 300px;*/
    position: relative;
  }
  /* Style the tab buttons */
  .tablinks {
    background-color: lightgray;
    color:black;
    float: left;
    border: none;
    outline: none;
    cursor: pointer;
    padding: 10px 10px;
    font-size: 15px;
    width: 33%;
  }
  /* left - right */
  .left {
  /* background-color:#2196F3;*/

    float:left;
    width:50%; /* The width is 20%, by default */
  }
  .right {
  /* background-color:#4CAF50;*/

    float:left;
    width:50%; /* The width is 20%, by default */
  }
  .overlay {
        fill: none;
        pointer-events: all;
    }

    .focus circle {
        fill: steelblue;
    }

    .focus text {
        font-size: 14px;
    }

    .tooltip {
        fill: white;
        stroke: #000;
    }

    .tooltip-date, .tooltip-likes {
        font-weight: bold;
    }

  /* Use a media query to add a break point at 800px: */
  @media screen and (max-width:1200px) {
    .left,  .right {
      width:100%; /* The width is 100%, when the viewport is 800px or smaller */
    }
  }
  </style>

  <script src="lib/d3.v5.min.js"></script>
  <script src="lib/d3-dsv.min.js"></script>
  <script src="lib/d3-scale-chromatic.v1.min.js"></script>
  <script src="lib/d3-fetch.min.js"></script>
  <script src="lib/topojson.v2.min.js"></script>
  <script src="d3.button.js"></script>
  <script src="lib/d3-tip.min.js"></script>
  <script src="https://d3js.org/d3-random.v2.min.js"></script>
</head>
<body>
    <h1><strong> Covid-19 Insight Beyond the Numbers!</strong></h1>
    <h5>
      <p>
        We have all heard of <em>"Flattening the curve"</em> and are bombarded with high volume of <em>"Covid 19 Statistics"</em>. But making sense of these numbers is no easy task, considering that the numbers and trend vary so much by the region. Here we will take you beyond the numbers!
        Leveraging Machine Learning algorithms, the Interactive visualizations on this page provides insights you cant get from simple graph or daily cases and deaths count.
      </h5>
      <p> Contributors:      Ahmad Ali (Data Wrangling and Machine Learning)       |     Rashaad Ahmad (Website Design)  |   Hammad Ahmad (Chart Ideas)
      </p>
        </p>
        <div id="dropdown-container"><h4>Choose an option to explore: </h4>
        </div>
    <!--div id="state" class = "left"-->
      <div id="state" >


    </div>
    <h5></h5>
    <h5></h5>
    <!--div id = "details" class = "right"-->
    <div id = "details" >
        <div class="tab">
          <button class="tablinks" onclick="openTab(event, 'map')" id="main">Main</button>
          <button class="tablinks" onclick="openTab(event, 'chart3')" id="scatter">Trend Comparison</button>
          <button class="tablinks" onclick="openTab(event, 'chart1')" id="linechart">Daily Trend By Region</button>
          <button class="tablinks" onclick="openTab(event, 'chart2')" id="heatmap">Heat Map</button>



        </div>
        <!--div id="main" class="tabcontent">
          <div id="map"></div>

          <div id="slideranimation">
            <button id="play-button">Play</button>
                <div id="slider"> </div>


          </div-->
      </div>
      <div id="map" class="tabcontent">
        <h4>Click on a state to explore State specific trend.</h4>
        <div id="slideranimation">
          <button id="play-button">Play</button>
              <div id="slider"> </div>


        </div>
        <!--div id="map"></div-->
      </div>
      <div id="chart1" class="tabcontent">



        <div id="state-dropdown-container"><h5> To select another state's trend, please click on the desired state on the map or select a value in drop dropDown:</h5>
        </div>


      </div>
      <div id="chart2" class="tabcontent">
          <h1> </h1>
          <h1> </h1>
          <p id="heatmapdesc">             </p>

      </div>
      <div id="chart3" class="tabcontent">
        <h1> </h1>
        <h1> </h1>
        <p>           </p>

    </div>
    </div>


  <div class="row">
    <div class="column">


    <div class="column">

    </div>
  </div>
  </div>




        <!--svg width="960" height="600"></svg-->
<script>
  //Tab management
  function openTab(evt, Name) {
  //  console.log("inside openTab");
    // Declare all variables
    var i, tabcontent, tablinks;
    // Get all elements with class="tabcontent" and hide them
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
      tabcontent[i].style.display = "none";
    }
    // Get all elements with class="tablinks" and remove the class "active"
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
   //   console.log("inside openTab - replace");
      tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    // Show the current tab, and add an "active" class to the button that opened the tab
    document.getElementById(Name).style.display = "block";
    evt.currentTarget.className += " active";
  }
  //document.getElementById("heatmap").click();
  //document.getElementById("details").style.display = "none";
    function responsivefy(svg) {
    // container will be the DOM element
    // that the svg is appended to
    // we then measure the container
    // and find its aspect ratio
    const container = d3.select(svg.node().parentNode),
        width = parseInt(svg.style('width'), 10),
        height = parseInt(svg.style('height'), 10),
        aspect = width / height;

    // set viewBox attribute to the initial size
    // control scaling with preserveAspectRatio
    // resize svg on inital page load
    svg.attr('viewBox', `0 0 ${width} ${height}`)
        .attr('preserveAspectRatio', 'xMinYMid')
        .call(resize);

    // add a listener so the chart will be resized
    // when the window resizes
    // multiple listeners for the same event type
    // requires a namespace, i.e., 'click.foo'
    // api docs: https://goo.gl/F3ZCFr
    d3.select(window).on(
        'resize.' + container.attr('id'),
        resize
    );

    // this is the code that resizes the chart
    // it will be called on load
    // and in response to window resizes
    // gets the width of the container
    // and resizes the svg to fill it
    // while maintaining a consistent aspect ratio
    function resize() {
        const w = parseInt(container.style('width'));
        svg.attr('width', w);
        svg.attr('height', Math.round(w / aspect));
    }
  }
var factor;
var clusterdata = "";
var maptitle = "";
var maptitlecombined = "";
var factorsList = [
                    "US - States - Trend",                           //0
                    "US - States - New Cases",                               //1
                    "US - Total Cases",               //2
                    "US - Death Count",               //3
                    "---------",                                  //4
                    "---------",                                    //5
                    "--------",                      //6
                    "---------",                     //7
                    "---------",  //8
                    "---------",                       //9
                    "US - Counties with High Number of cases - Trend",                  //10
                    "US - Counties with High Number of cases - New Cases",                         //11
                    "US - Counties with High Number of cases - Total Cases",                           //12
                    "---------",                                         //13
                    "---------",                                        //14
                    "---------",                                          //15
                    "---------",                                          //16
                    "---------",                                          //17
                    "---------",                                          //18
                    "---------",                                          //19
                    "India - States - Trend",                           //20
                    "---------",                                          //21
                    "---------" ,                                         //22
                    "---------"  ,                                        //23
                    "---------"   ,                                       //24
                    "World - Countries - Trend"    ,                     //25
                    "---------"                                         //26

                    ];
var dropdownlist = [factorsList[0], factorsList[1],factorsList[20],factorsList[25]]
var seasonaltempinterval = 10
var winwidth = window.innerWidth
      || document.documentElement.clientWidth
      || document.body.clientWidth;
    winheight = window.innerHeight
    || document.documentElement.clientHeight
    || document.body.clientHeight;
    console.log(winwidth,winheight)
    wd = winwidth*.8
    wd_l = winwidth*.8
    wd_s = winwidth*.75
  /*
  if(winwidth>800) {
    var wd = winwidth/2;
    }
    if(winwidth<=800) {
    var wd = winwidth;
    }*/
height_ratio_s = 1.5

var scale = wd/960;
var margin = {top: 50, right: 20, bottom: 15, left: 10};
var margin_s = {top: 70, right: 10, bottom: 80, left: 150};
var margin_l = {top: 70, right: 200, bottom: 80, left: 60};
var width = wd - margin.left - margin.right,
  height = 700*scale - margin.top - margin.bottom;
var width_l = wd_l - margin_l.left - margin_l.right,   //line and scatter
    height_l = wd_l*.65 - margin_l.top - margin_l.bottom;
var width_s = wd_s - margin_s.left - margin_s.right, //heatmap
    height_s = wd_s*2 - margin_s.top - margin_s.bottom;


////////////----------------------------------------------------------------slider

var formatDateIntoYear = d3.timeFormat("%Y");
var formatDate = d3.timeFormat("%m/%d");
var formatDate_mdy = d3.timeFormat("%-m/%-d/%y");
var parseDate = d3.timeParse("%m/%d/%y");
var parseYear = d3.timeParse("%Y");
var nyears = 3; // moving average
var moving = false;
var currentValue = 0;
var targetValue = width;
var playButton = d3.select("#play-button")
                    .attr("top",margin.top/20+margin.bottom/100)
                    .attr("left",margin.left)
                    //top: 150px;
                    // left: 10px;
                    ;
var svgslider = d3.select("#slider")
    .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height/25 + margin.top + margin.bottom);
var slider = svgslider.append("g")
    .attr("class", "slider")
    .attr("transform", "translate(" + (margin.left+15) + "," + 10 + ")");


    var div = d3.select("body").append("div")
		 .attr("class", "tooltip")
		 .style("opacity", 0);
////
/////-------------------------------------------------------------------------- Map
var svg;
/*var svg = d3.select("#map")
              .append("svg")
              .attr("width", width + margin.left + margin.right)
              .attr("height", height + margin.top + margin.bottom)
              .append("g")
              .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
              .call(responsivefy)
              ;
              */
var projection = d3.geoAlbersUsa()
    .scale(scale*960)
    .translate([width / 2, height / 2]);
var path = d3.geoPath()
            .projection(projection);
var projection1 = d3.geoAlbersUsa().scale(1300).translate([487.5, 305])

/*  d3.geoAlbersUsa()
        .scale(800)
          .translate([width / 2, height / 2])  */

var path1 = d3.geoPath()
 .projection(projection);

var long_data = [];
var linemaptype;
var heatmaptype;
var heatmaptitle
var promises = [
  //d3.json("https://d3js.org/us-10m.v1.json"),
  d3.json("states-10m.json"),
  d3.json('counties-10m.json'),
  //d3.json("counties-albers-10m.json"),
  d3.csv("us_cases_change_data.csv"),
  d3.csv('us_daily_case_data.csv'),
  d3.csv('us_total_case_data.csv'),
  d3.csv("us_case_data_slope.csv"),
  d3.csv("us_case_start_sorted.csv"),
  d3.csv("us_case_peak_data.csv"),

  d3.csv("us_deaths_change_data.csv"),
  d3.csv('us_daily_death_data.csv'),
  d3.csv('us_total_death_data.csv'),
  d3.csv("us_death_data_slope.csv"),
  d3.csv("us_death_start_sorted.csv"),
  d3.csv("us_death_peak_data.csv"),
  /*county
  d3.csv("county_cases_change_data.csv"),
  d3.csv('county_daily_case_data.csv'),
  d3.csv('county_total_case_data.csv'),
  d3.csv("county_case_data_slope.csv"),
  d3.csv("county_case_start_sorted.csv"),
  d3.csv("county_case_peak_data.csv"),

  d3.csv("county_deaths_change_data.csv"),
  d3.csv('county_daily_death_data.csv'),
  d3.csv('county_total_death_data.csv'),
  d3.csv("county_death_data_slope.csv"),
  d3.csv("county_death_start_sorted.csv"),
  d3.csv("county_death_peak_data.csv"),
*/
  d3.csv("india_cases_change_data.csv"),
  d3.csv('india_daily_case_data.csv'),
  d3.csv('india_total_case_data.csv'),
  d3.csv("india_case_data_slope.csv"),
  d3.csv("india_case_start_sorted.csv"),
  d3.csv("india_case_peak_data.csv"),

  d3.csv("india_deaths_change_data.csv"),
  d3.csv('india_daily_death_data.csv'),
  d3.csv('india_total_death_data.csv'),
  d3.csv("india_death_data_slope.csv"),
  d3.csv("india_death_start_sorted.csv"),
  d3.csv("india_death_peak_data.csv"),

  d3.csv("global_cases_change_data.csv"),
  d3.csv('global_daily_case_data.csv'),
  d3.csv('global_total_case_data.csv'),
  d3.csv("global_case_data_slope.csv"),
  d3.csv("global_case_start_sorted.csv"),
  d3.csv("global_case_peak_data.csv"),

  d3.csv("global_deaths_change_data.csv"),
  d3.csv('global_daily_death_data.csv'),
  d3.csv('global_total_death_data.csv'),
  d3.csv("global_death_data_slope.csv"),
  d3.csv("global_death_start_sorted.csv"),
  d3.csv("global_death_peak_data.csv")

]
Promise.all(promises).then(ready)
function ready([us,us_counties,
                us_cases_change_data,us_daily_case_data,us_total_case_data, us_case_data_slope,us_case_start_sorted,us_case_peak_data,
                us_deaths_change_data,us_daily_death_data,us_total_death_data, us_death_data_slope,us_death_start_sorted,us_death_peak_data,
               // county_cases_change_data,county_daily_case_data,county_total_case_data, county_case_data_slope,county_case_start_sorted,county_case_peak_data,
                //county_deaths_change_data,county_daily_death_data,county_total_death_data, county_death_data_slope,county_death_start_sorted,county_death_peak_data,
                india_cases_change_data,india_daily_case_data,india_total_case_data, india_case_data_slope,india_case_start_sorted,india_case_peak_data,
                india_deaths_change_data,india_daily_death_data,india_total_death_data, india_death_data_slope,india_death_start_sorted,india_death_peak_data,
                global_cases_change_data,global_daily_case_data,global_total_case_data, global_case_data_slope,global_case_start_sorted,global_case_peak_data,
                global_deaths_change_data,global_daily_death_data,global_total_death_data, global_death_data_slope,global_death_start_sorted,global_death_peak_data,

          ])
  {
  var bisectDate = d3.bisector(function(d) { return d.date; }).left
  var  formatValue = d3.format(",")
  var parser = d3.timeParse("%m/%d/%y")
  var parser4d = d3.timeParse("%m/%d/%Y")
  //console.log(topojson.feature(us, us.objects.states).features)
 // console.log(us)
 console.log(us_counties)
  //console.log(topojson.feature(us_counties, us_counties.objects.counties).features)


  minDailyCaseUS= d3.min(us_daily_case_data, function(d) { return +d.value; });
    maxDailyCaseUS = d3.max(us_daily_case_data, function(d) { return +d.value; });



    startDate = d3.min(us_daily_case_data, function(d) { return parser(d.Date); });
  endDate = d3.max(us_daily_case_data, function(d) { return parser(d.Date); });

  //minDailyRatioUS= d3.min(us_case_data_slope, function(d) { return +d.value; });
  //maxDailyRatioUS = d3.max(us_case_data_slope, function(d) { return +d.value; });
  //console.log(minDailyRatioUS,maxDailyRatioUS)

  //console.log(us_cases_change_data)
  //startDate = new Date();
  //startDate.setDate(sDate.getDate()-90);
  //console.log(startDate, endDate)

  endDate_ext = new Date();
  endDate_ext.setDate(endDate.getDate()+0);
    console.log(endDate_ext)
  var x_slider = d3.scaleTime()
      .domain([startDate, endDate])
      .range([0, width])
      .clamp(true);
  var logScale = d3.scaleLog()
    //.base(Math.E)
    .domain([Math.exp(0), Math.exp(9)])
    .range([0, 1]);
  //console.log(us)
  //console.log(us_cases_change_data)
    /* Initialize tooltip */
  //console.log("in promises")

  //var uniquestate = [...new Set(us_cases_change_data.map(item =>item.Province_State))].sort()
  var uniquestate = [...new Set(us_case_start_sorted.map(item =>item.Province_State))]
  var uniquestatesorted =  [...new Set(us_case_start_sorted.map(item =>item.Province_State))].sort()

  //var uniquecounty = [...new Set(county_case_start_sorted.map(item =>item.Province_State))]
  //var uniquecountysorted =  [...new Set(county_case_start_sorted.map(item =>item.Province_State))].sort()

  var uniqueIndiaState = [...new Set(india_case_start_sorted.map(item =>item.Province_State))]
  var uniqueIndiaStatesorted =  [...new Set(india_case_start_sorted.map(item =>item.Province_State))].sort()

  var uniqueGlobalState = [...new Set(global_case_start_sorted.map(item =>item.Province_State))]
  var uniqueGlobalStatesorted =  [...new Set(global_case_start_sorted.map(item =>item.Province_State))].sort()
  //console.log(uniquestate)
    var tempdate = [...new Set(us_daily_case_data.map(item =>parser(item.Date)))].sort()
    tempdate.forEach(d=>formatDate_mdy(d))

   var uniqueday = [...new Set(us_daily_case_data.map(item =>item.Date))]
  //var uniqueday = [...new Set(us_daily_case_data.map(item =>item.Date))].sort()
  var lastday = uniqueday[uniqueday.length -1]
  //console.log(lastday)
 // console.log(uniqueday)
  //console.log(tempdate)
  interval = uniqueday.length


  var x_heat = d3.scaleBand().range([0, width_s]),
                        y_line = d3.scaleLinear().range([height_l, 0]),
                        y_lineLog = d3.scaleLog().range([height_l, 0]),
                        x_line = d3.scaleTime().range([0, width_l])
                        x_line.domain([startDate, endDate]);

                        y_heat = d3.scaleBand().range([0, height_s]),
                        y_heat.domain(uniquestate);

        var x_barScale = d3.scaleBand().range([0, width_l]).padding(0.4),
            y_barScale = d3.scaleLinear().range([height_l, 0]);
            //x_barScale.domain([startDate, endDate_ext])
  var heatmapScale = d3.scaleThreshold();
  var sizeLogscale = d3.scalePow()
                      .exponent(2)
                      .range([4,12])

  function FIPS(num) {
    var s = "00000" + num;
    return s.substr(s.length-5);


}
//console.log(FIPS('234'), FIPS('1234'),FIPS('12345'))
    /*
  us_cases_change_data.forEach(function(d) {
    var result = brands.filter(function(brand) {
        return brand.id === article.brand_id;
    });
    delete article.brand_id;
    article.brand = (result[0] !== undefined) ? result[0].name : null;
  });
  console.log(articles);
  */
    factor = factorsList[0];
    var tooltiptext;
    var colorScale = d3.scaleThreshold();
    colorScale.range(d3.schemeOranges[9]);
    //tooltiptext = "Max Temp: ";
    //legendText = "Temperature  (F)"
    //maptitle = "Max Temperature for "
    firsttime = 0

    cdata = []
    var y_scatter = d3.scaleLinear().range([height_l, 0]),
      y_scatterLog = d3.scaleLog().range([height_l, 0])
        x_scatter = d3.scaleLinear().range([0, width_l])
        x_scatterLog = d3.scaleLog().range([0, width_l])
        ;

            function movingAverage(values, N) {
                let i = 0;
                let sum = 0;
                const means = new Float64Array(values.length).fill(NaN);
                for (let n = Math.min(N - 1, values.length); i < n; ++i) {
                    sum += values[i];
                }
                for (let n = values.length; i < n; ++i) {
                    sum += values[i];
                    means[i] = sum / N;
                    sum -= values[i - N + 1];
                }
               // console.log(values)
                //console.log(means)
                return means;
            }


    var dropdownChange = function(){
            //console.log(firsttime, factor)
                d3.select("#map").selectAll("svg").remove();

                svg = d3.selectAll("#map")
                      .append("svg")
                      .attr("width", width + margin.left + margin.right)
                      .attr("height", height + margin.top + margin.bottom)
                      .append("g")
                      .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
                      .call(responsivefy)
                      ;

                d3.select("#chart1").selectAll("svg").remove();
                d3.select("#chart2").selectAll("svg").remove();
                d3.select("#chart3").selectAll("svg").remove();
                d3.select("#chart3").selectAll("p").remove();
                clusterdata = "no"
                maptitle = ""
                //console.log(factor)

            //document.getElementById("details").style.display = "none";
                if (firsttime == 0){
                  firsttime = 1
                  factor == factorsList[0]
                  factor1 = factor
                }
                else{
                  factor = d3.select(this).property('value');

                  }
                //console.log(firsttime, factor)
                if(factor == factorsList[1]){

                  d3.select("#main").text("Main")
                   //   d3.select("#linechart").text("Daily New Cases")

                      document.getElementById("scatter").style.display = "none";
                   // heatmaptitle = "New Cases for all States"
                   // d3.select("#heatmap").text(heatmaptitle)
                   // d3.select("#heatmapdesc").text("This heat map provides insight into number of new cases for each state")


                    mapdata = us_daily_case_data
                    maptype = 'state'
                    minmap= Math.log10(d3.min(mapdata, function(d) { return +d.value; }));
                    maxmap = Math.ceil(Math.log10(d3.max(mapdata, function(d) { return +d.value; })));
                    //console.log(d3.range(minmap, maxmap,1))
                    colorScale.domain(d3.range(0, maxmap, 1));//minmap is infinity
                    colorScale.range(d3.schemeOranges[6]);


                    //colorScale.domain(uniqueCluster);
                    //console.log(colorScale)
                                  //colorScale.range("",d3.schemeRdYlGn[9],d3.schemeRdYlGn[0])

                    tooltiptext = "New Cases: ";
                    legendText = "New Cases"
                    maptitle = "US - Daily New Cases"
                    svg = d3.selectAll("#map")
                          .append("svg")
                          .attr("width", width + margin.left + margin.right)
                          .attr("height", height + margin.top + margin.bottom)
                          .append("g")
                          .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
                          .call(responsivefy)
                          ;
                    updateMap(lastday,'');
                    updateLegend();


                    heatmaptype = "dailycase"
                    s_legendtext = "New cases"

                    heatmapdata = us_daily_case_data


                    x_heat.domain(heatmapdata.map(function(d) { return parser4d(d.Date); }));

                    y_heat_domain = uniquestate
                    height_ratio = height_ratio_s * y_heat_domain.length/50
                    height_s = height_ratio*width_s
                    y_heat.range([0, height_s])
                    y_heat.domain(y_heat_domain);
                    //maxheatmap = 50
                    band = 1
                    heatmapScale.domain(d3.range(0,Math.log10(maxDailyCaseUS), band));
                    heatmapScale.range(d3.range(0, 1, band*.8/(Math.log10(maxDailyCaseUS))));
                    //heatmapScale.domain(d3.range(minDailyRatioUS,maxDailyRatioUS, 50));
                    //heatmapScale.range(d3.range(0, 1, 50*.95/(max-minDailyRatioUS)));




                    updateMap(lastday,'');

                    updateLegend();

                    updateHeatmap();
                    linechartdropdown = uniquestatesorted;
                    updateLinechart(linechartdropdown[0]);

                    document.getElementById("slideranimation").style.display = "block";
                    document.getElementById("linechart").click();
                    document.getElementById("main").style.display = "block";
                  document.getElementById("main").click();
                }
                else if(factor == factorsList[2]){

                        d3.select("#main").text("Main")
                        d3.select("#linechart").text("Total Cases for State")
                        document.getElementById("scatter").style.display = "none";
                        heatmaptitle = "Total Cases for all States"
                        d3.select("#heatmap").text(heatmaptitle)
                        d3.select("#heatmapdesc").text("This heat map provides insight into number of total cases for each state")



                    minmap= Math.log10(d3.min(mapdata, function(d) { return +d.value; }));
                    maxmap = Math.log10(d3.max(mapdata, function(d) { return +d.value; }));

                    colorScale.domain(d3.range(0, maxmap+1, 1));//minmap is infinity
                    colorScale.range(d3.schemeOranges[7]);

                    console.log(colorScale)


                    tooltiptext = "Total Cases: ";
                    legendText = "Total Cases"
                    maptitle = "US - Total Cases"
                    mapjson = topojson.feature(us, us.objects.states).features
                    mapdata = us_total_case_data
                    maptype = 'state'

                    heatmapdata = us_total_case_data
                    heatmaptype = "dailycase"
                    s_legendtext = "Total cases"



                    x_heat.domain(heatmapdata.map(function(d) { return parser4d(d.Date); }));
                    //maxheatmap = 50
                    y_heat_domain = uniquestate
                    height_ratio = height_ratio_s * y_heat_domain.length/50
                    height_s = height_ratio*width_s
                    y_heat.range([0, height_s])
                    y_heat.domain(y_heat_domain);

                    band = 1
                    maxHmap= Math.log10(d3.max(heatmapdata, function(d) { return +d.value; }));

                    heatmapScale.domain(d3.range(0,maxHmap, band));
                    heatmapScale.range(d3.range(0, 1, band*.8/(maxHmap)));
                    //heatmapScale.domain(d3.range(minDailyRatioUS,maxDailyRatioUS, 50));
                    //heatmapScale.range(d3.range(0, 1, 50*.95/(max-minDailyRatioUS)));
                  updateMap(lastday,'');
                  updateLegend();
                  updateHeatmap();
                  linechartdropdown = uniquestatesorted;
                    updateLinechart(linechartdropdown[0]);

                    document.getElementById("slideranimation").style.display = "block";
                    document.getElementById("linechart").click();
                    document.getElementById("main").style.display = "block";
                    document.getElementById("main").click();
                }
                else if(factor == factorsList[0]){

                    clusterdata = "yes"




                      d3.select("#main").text("Main")
                   //   d3.select("#linechart").text("Daily New Cases for State")

                  //    d3.select("#scatter").text("Short Term and Long Term trend")
                //      heatmaptitle = "Trend in New Cases by State"

                  //    d3.select("#heatmap").text(heatmaptitle)
                  //    d3.select("#heatmapdesc").text("This heat map provides insight into how the number of new cases have trended over the period")
                      document.getElementById("scatter").style.display = "block";

                      mapdata = us_cases_change_data
                      maptype = 'state'
                      var uniqueCluster = [...new Set(us_cases_change_data.map(item =>+item.risklevel))].sort()
                    // colorScale.domain(['0','1','2','3','4'])
                      colorScale.domain(uniqueCluster);
                    // console.log(colorScale)
                                    //colorScale.range("",d3.schemeRdYlGn[9],d3.schemeRdYlGn[0])
                      //colorScale.range(["",d3.interpolateRdYlGn(.2),d3.interpolateRdYlGn(.3),d3.interpolateRdYlGn(.4),d3.interpolateRdYlGn(.65),d3.interpolateGreys(.2)])
                      colorScale.range(["",d3.interpolateSpectral(.15),d3.interpolateSpectral(.25),d3.interpolateSpectral(.4),d3.interpolateSpectral(.72),d3.interpolateGreys(.2)])
                      clusterDesc = ["Not Improving","Short Term Improving","Was Improving but Uptick","Improving or Flat","Low # of Current Cases"]
                      tooltiptext = "Trend: ";
                      legendText = "Trend"
                      maptitle = "Short Term (7 days) and Long Term (14 Days) Trend "
                      mapjson = topojson.feature(us, us.objects.states).features
                      /*
                      mapjson.forEach(d => {

                        var mdata = mapdata.filter(function(t){return t.Province_State == d.properties.name ;})

                        //console.log(mdata)
                        if (mdata.length > 0){
                          d.mapvalue = +mdata[0].risklevel
                          d.color = colorScale((+mdata[0].risklevel))
                          d.Date = lastday
                        }// colorScale(Math.log10(d.fact))
                        console.log(d)
                      });
                        */
                      //console.log(mapjson)



                            heatmaptype = "trend"
                            s_legendtext = "% Change in Daily Cases"
                            heatmapdata = us_case_data_slope
                            x_heat.domain(heatmapdata.map(function(d) { return parser4d(d.Date); }));

                            y_heat_domain = uniquestate
                            height_ratio = height_ratio_s * y_heat_domain.length/60
                            //console.log(height_s)
                            height_s = height_ratio*width_s- margin_s.top - margin_s.bottom;
                            //console.log(height_s)
                            y_heat.range([0, height_s])
                            y_heat.domain(y_heat_domain);



                            maxheatmap = 50
                            band = 10
                            heatmapScale.domain(d3.range(-maxheatmap,maxheatmap+1, band));
                            heatmapScale.range(d3.range(.1, 1, band*.8/(2*maxheatmap)));
                            //heatmapScale.domain(d3.range(minDailyRatioUS,maxDailyRatioUS, 50));
                            //heatmapScale.range(d3.range(0, 1, 50*.95/(max-minDailyRatioUS)));
                          updateMap(lastday,'');
                          updateLegend();
/*
                          clusterdata = "no"
                          mapdata = us_daily_case_data
                          maptype = 'state'
                          minmap= Math.log10(d3.min(mapdata, function(d) { return +d.value; }));
                          maxmap = Math.ceil(Math.log10(d3.max(mapdata, function(d) { return +d.value; })));
                          //console.log(d3.range(minmap, maxmap,1))
                          colorScale.domain(d3.range(0, maxmap, 1));//minmap is infinity
                          colorScale.range(d3.schemeOranges[6]);


                          //colorScale.domain(uniqueCluster);
                          console.log(colorScale)
                                        //colorScale.range("",d3.schemeRdYlGn[9],d3.schemeRdYlGn[0])

                          tooltiptext = "New Cases: ";
                          legendText = "New Cases"
                          maptitle = "US - Daily New Cases"

                          svg = d3.selectAll("#map")
                                .append("svg")
                                .attr("width", width + margin.left + margin.right)
                                .attr("height", height + margin.top + margin.bottom)
                                .append("g")
                                .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
                                .call(responsivefy)
                                ;
                          updateMap(lastday,'');
                          updateLegend();
*/

                      

                          scatterdata = us_cases_change_data
                          scatterdata.forEach(d => {
                                        d.x = (+d.long_term_slope)
                                        d.y = (+d.short_term_slope)
                                        d.size = (+d.avg)
                                        d.col = colorScale(+d.risklevel)
                                      })
                          updateScatter(scatterdata,
                                          "Short Term (7 days) vs Long Term (14 days) Trend in Daily New Cases",
                                          "Size represents the Daily Average",

                                          "7 days Rate of Change(%) in Daily Number of Cases",
                                          "Long Term  (14 days)  Rate of Change(%) in Daily Number of Cases","");



                          scatterdata  = us_deaths_change_data
                          scatterdata.forEach(d => {
                                        d.x = (+d.long_term_slope)
                                        d.y = (+d.short_term_slope)
                                        d.size = (+d.avg)
                                        d.col = colorScale(+d.risklevel)
                                      })

                            updateScatter(scatterdata,
                                          "Short Term (7 days) vs Long Term  (14 days)  Trend in Daily Deaths",
                                          "Size represents the Daily Average",
                                          "7 days Rate of Change(%) in Daily Deaths",
                                          "Long Term (14 days)  Rate of Change(%) in Daily Deaths",
                                          "");

                           scatterdata  = us_deaths_change_data
                          //console.log(scatterdata)
                          //console.log(scatterdata)
                          scatterdata.forEach(d => {
                                        d.x = (+d.total_death)
                                        d.y = (+d.death_rate)
                                        d.size = (+d.avg)
                                        if (d.size <= 0)
                                          {
                                            d.size = 1
                                          }
                                        d.col = colorScale(+d.risklevel)
                                      })
                          updateScatter(scatterdata,
                          "Death Rate (% of Total Cases)",
                            "Size represents the Daily Average",
                              "Death Rate as % of Total Cases",
                              "Total Deaths(Log Scale)",
                              "log");


                          scatterdata  =  us_case_peak_data

                          var uniqueCluster = [...new Set(scatterdata.map(item =>+item.cluster))].sort()
                    // colorScale.domain(['0','1','2','3','4'])
                    clusterDesc = ["Peaked in last 2 weeks","Below AVG Rate","Above AVG Rate","90% down from Peak"]
                    colorScale.range(["",d3.interpolateSpectral(.10),d3.interpolateSpectral(.25),d3.interpolateSpectral(.7),d3.interpolateSpectral(.85),d3.interpolateGreys(.2)])

                          colorScale.domain(uniqueCluster);
                          scatterdata.forEach(d => {
                              var temp = us_cases_change_data.filter(function (t){ return t.Province_State === d.Province_State })
                              //console.log(temp)
                              if (temp.length>0)   {
                                d.code = temp[0].code

                                        d.x = (+d.days_since_peak)
                                        d.y = (+d.percent_of_peak)
                                        d.size = (+d.avg)
                                        d.col = colorScale(+d.cluster)
                                      }
                              else {
                                        delete d
                                      }
                                      })
                         // console.log(scatterdata)
                          updateScatter(scatterdata,
                                          "Current Daily Case count(average) as % of Peak and Days since the Peak",
                                          "Size represents the Daily Average",

                                          "Current Daily Average as % of Peak number of Cases for the State",
                                          "Number of Days since Peak",
                                          "");
                          d3.select("#chart3").append("p").text("This chart shows how close or far the states are from their peak in terms of count and days. States on the left side on the plot(within 15 days of the peak), are too close to peak to establish a trend. For the states whose peak was more than 2 weeks ago, they are compared on trending down slope - States on the lower right region of the plot are trending faster than States on the top region. Size of the circle represents the current daily count.");

                      //clusterDesc = ["Peaked in last 2 weeks","Trending down but slowly","Trending down "]
                          var uniqueCluster = [...new Set(scatterdata.map(item =>+item.cluster))].sort()
                    // colorScale.domain(['0','1','2','3','4'])
                      colorScale.domain(uniqueCluster);
                          //  console.log(us_death_peak_data)
                          scatterdata  =  us_death_peak_data
                          scatterdata.forEach(d => {
                              var temp = us_deaths_change_data.filter(function (t){ return t.Province_State === d.Province_State })
                              //console.log(scatterdata)
                              if (temp.length>0)   {
                                d.code = temp[0].code

                                        d.x = (+d.days_since_peak)
                                        d.y = (+d.percent_of_peak)
                                        d.size = (+d.avg)
                                        d.col = colorScale(+d.cluster)
                                      }
                                      })

                          updateScatter(scatterdata,
                                          "Current Daily Death count(average) as % of Peak and Days since the Peak",
                                          "Size represents the Daily Average",

                                          "Current Daily Average as % of Peak number of Daily Deaths for the State",
                                          "Number of Days since Peak",
                                          "");






                          updateHeatmap();
                          linechartdropdown = uniquestatesorted;
                          updateLinechart(linechartdropdown[0]);
                          //-------------


                      document.getElementById("slideranimation").style.display = "none";
                      //document.getElementById("linechart").click();
                      document.getElementById("main").style.display = "block";
                      document.getElementById("main").click();

                    }

                else if(factor == factorsList[10]){

                      clusterdata = "yes"



                        d3.select("#main").text("Main")
                        //document.getElementById("main").style.display = "none";
                       // d3.select("#linechart").text("Daily New Cases for Counties")
                       // d3.select("#scatter").text("Short Term and Long Term trend")
                      //  heatmaptitle = "Trend in new cases by Counties"

                        //d3.select("#heatmap").text(heatmaptitle)
                        //d3.select("#heatmapdesc").text("This heat map provides insight into how the number of new cases have trended over the period")
                        document.getElementById("scatter").style.display = "block";

                        mapdata = county_cases_change_data

                        var uniqueCluster = [...new Set(county_cases_change_data.map(item =>+item.risklevel))].sort()
                        //colorScale.domain(['0','1','2','3','4'])
                        colorScale.domain(uniqueCluster);
                      // console.log(colorScale)
                                      //colorScale.range("",d3.schemeRdYlGn[9],d3.schemeRdYlGn[0])
                        colorScale.range(["",d3.interpolateRdYlGn(.2),d3.interpolateRdYlGn(.3),d3.interpolateRdYlGn(.4),d3.interpolateRdYlGn(.6),d3.interpolateGreys(.2)])
                        clusterDesc = [ "Not Improving","Short Term Improving","Was Improving but Uptick","Improving or Flat","Low # of Current Cases"]
                        tooltiptext = "Trend: ";
                        legendText = "Trend"
                        maptitle = "Short Term (7 days) and Long Term (14 Days) Trend "
                        //mapjson = topojson.feature(us_counties, us_counties.objects.counties).features
                        maptype = 'county'

                        //console.log(mapjson)
                              scatterdata = county_cases_change_data

                              //console.log(scatterdata)
                         /*     minx_scatter= 1.1*d3.min(scatterdata, function(d) { return +d.long_term_slope ; });
                              maxx_scatter= 1.1*d3.max(scatterdata, function(d) { return +d.long_term_slope ; });
                              miny_scatter= 1.1*d3.min(scatterdata, function(d) { return +d.short_term_slope ; });
                              maxy_scatter= 1.1*d3.max(scatterdata, function(d) { return +d.short_term_slope ; });

                              x_scatter.domain([minx_scatter, maxx_scatter]);
                              y_scatter.domain([miny_scatter, maxy_scatter]);

                              sc_legend_x = [x_scatter(0),x_scatter(0),x_scatter(minx_scatter), x_scatter(minx_scatter)]
                              console.log(sc_legend_x)
                              sc_legend_y = [y_scatter(maxy_scatter),y_scatter(0),y_scatter(maxy_scatter),y_scatter(0)]
                              sc_legend_Xend = [x_scatter(maxx_scatter),x_scatter(maxx_scatter), x_scatter(0),x_scatter(0)]

                              sc_legend_yend = [y_scatter(0),y_scatter(miny_scatter),y_scatter(0),y_scatter(miny_scatter)]
                              scatter_domain = colorScale.domain().slice(0, 4);

                              minSize = d3.min(scatterdata, function(d) { return +d.avg ; });
                              maxSize = d3.max(scatterdata, function(d) { return +d.avg ; });
                              sizeLogscale.domain([minSize, maxSize])
                              console.log(minSize, maxSize)
                              scatterdata.forEach(d => {
                                    d.col = colorScale(+d.risklevel)
                                    d.x = x_scatter(+d.long_term_slope)
                                    d.y = y_scatter(+d.short_term_slope)
                                    d.size = sizeLogscale(+d.avg)
                                  })
                                */
                              heatmaptype = "trend"
                              s_legendtext = "% Change in Daily Cases"
                              //y_heat.domain(uniquecounty);
                              heatmapdata = county_case_data_slope
                              x_heat.domain(heatmapdata.map(function(d) { return parser4d(d.Date); }));

                              y_heat_domain = uniquecounty
                              height_ratio = height_ratio_s * y_heat_domain.length/50
                              height_s = height_ratio*width_s
                              y_heat.range([0, height_s])
                              y_heat.domain(y_heat_domain);



                              maxheatmap = 50
                              band = 10
                              heatmapScale.domain(d3.range(-maxheatmap,maxheatmap+1, band));
                              heatmapScale.range(d3.range(.1, 1, band*.8/(2*maxheatmap)));
                              //heatmapScale.domain(d3.range(minDailyRatioUS,maxDailyRatioUS, 50));
                              //heatmapScale.range(d3.range(0, 1, 50*.95/(max-minDailyRatioUS)));
                            updateMap(lastday,'');
                            updateLegend();

                            scatterdata = county_cases_change_data
                            scatterdata.forEach(d => {
                                    d.x = (+d.long_term_slope)
                                    d.y = (+d.short_term_slope)
                                    d.size = (+d.avg)
                                    d.col = colorScale(+d.risklevel)
                                  })
                          updateScatter(scatterdata,
                                          "Short Term (7 days) vs Long Term (14 days) Trend in Daily New Cases",
                                          "Size represents the Daily Average",
                                          "7 days Rate of Change(%) in Daily Number of Cases",
                                          "14 days Rate of Change(%) in Daily Number of Cases","");


                          scatterdata  = county_deaths_change_data
                          scatterdata.forEach(d => {
                                        d.x = (+d.long_term_slope)
                                        d.y = (+d.short_term_slope)
                                        d.size = (+d.avg)
                                        d.col = colorScale(+d.risklevel)
                                      })

                            updateScatter(scatterdata,
                                          "Short Term (7 days) vs Long Term (14 days) Trend in Daily Deaths",
                                          "Size represents the Daily Average",
                                          "7 days Rate of Change(%) in Daily Deaths",
                                          "14 days Rate of Change(%) in Daily Deaths",
                                          "");
                          scatterdata  = county_deaths_change_data
                          //console.log(scatterdata)
                          //console.log(scatterdata)
                          scatterdata.forEach(d => {
                                    if (+d.death_rate != NaN )
                                    {
                                        d.x = (+d.total_death)
                                        d.y = (+d.death_rate)
                                        d.size = (+d.avg)
                                        if (d.size <= 0)
                                          {
                                            d.size = 1
                                          }
                                        d.col = colorScale(+d.risklevel)
                                        }
                                        else{
                                        delete d
                                        }
                                      })
                            updateScatter(scatterdata,
                            "Death Rate (% of Total Cases)",
                            "Size represents the Daily Average",
                              "Death Rate as % of Total Cases",
                              "Total Deaths(Log Scale)",
                              "");


                          scatterdata  =  county_case_peak_data
                          var uniqueCluster = [...new Set(scatterdata.map(item =>+item.cluster))].sort()
                    // colorScale.domain(['0','1','2','3','4'])
                      colorScale.domain(uniqueCluster);
                      clusterDesc = ["Peaked in last 2 weeks","Below AVG Rate","Above AVG Rate","90% down from Peak"]
                    colorScale.range(["",d3.interpolateSpectral(.10),d3.interpolateSpectral(.25),d3.interpolateSpectral(.7),d3.interpolateSpectral(.85),d3.interpolateGreys(.2)])

                          scatterdata.forEach(d => {
                            if (+d.percent_of_peak != NaN )
                                    {
                                      console.log(d)
                              var temp = county_cases_change_data.filter(function (t){ return t.Province_State === d.Province_State })
                              //console.log(temp)
                              if (temp.length>0)   {
                                d.code = temp[0].code

                                        d.x = (+d.days_since_peak)
                                        d.y = (+d.percent_of_peak)
                                        d.size = (+d.avg)
                                        d.col = colorScale(+d.cluster)
                                      }
                                    }
                                    else

                                    {console.log(d)
                                      delete d}
                                      })


                          updateScatter(scatterdata,
                                          "Current Daily Case count(average) as % of Peak and Days since the Peak",
                                          "Size represents the Daily Average",

                                          "Current Daily Average as % of Peak number of Cases for the County",
                                          "Number of Days since Peak",
                                          "");


                          scatterdata  =  county_death_peak_data
                          scatterdata.forEach(d => {
                              var temp = county_deaths_change_data.filter(function (t){ return t.Province_State === d.Province_State })
                              //console.log(temp)
                              if (temp.length>0)   {
                                d.code = temp[0].code

                                        d.x = (+d.days_since_peak)
                                        d.y = (+d.percent_of_peak)
                                        d.size = (+d.avg)
                                        d.col = colorScale(+d.cluster)
                                      }
                                      })
                        //  clusterDesc = ["Peaked in last 2 weeks","Trending down but slowly","Trending down "]
                          var uniqueCluster = [...new Set(scatterdata.map(item =>+item.cluster))].sort()
                    // colorScale.domain(['0','1','2','3','4'])
                      colorScale.domain(uniqueCluster);
                          updateScatter(scatterdata,
                                          "Current Daily Death count(average) as % of Peak and Days since the Peak",
                                          "Size represents the Daily Average",

                                          "Current Daily Average as % of Peak number of Daily Deaths for the County",
                                          "Number of Days since Peak",
                                          "");





                     //  updateHeatmap();
                            linechartdropdown = uniquecountysorted;
                            updateLinechart(linechartdropdown[0]);

                        document.getElementById("slideranimation").style.display = "none";
                        document.getElementById("main").click();

                      }

                else if(factor == factorsList[11]){

                        d3.select("#main").text("Main")
                        d3.select("#linechart").text("Daily New Cases")

                          document.getElementById("scatter").style.display = "none";
                          heatmaptitle = "New Cases by Counties"
                          d3.select("#heatmap").text(heatmaptitle)
                          d3.select("#heatmapdesc").text("This heat map provides insight into number of new cases for Counties with High Number of cases")


                          mapdata = county_daily_case_data
                          maptype = 'county'
                          minmap= Math.log10(d3.min(mapdata, function(d) { return +d.value; }));
                          maxmap = Math.ceil(Math.log10(d3.max(mapdata, function(d) { return +d.value; })));
                          console.log(minmap, maxmap)
                          colorScale.domain(d3.range(0, maxmap+1, 1));//minmap is infinity
                          colorScale.range(d3.schemeOranges[6]);


                          //colorScale.domain(uniqueCluster);
                          console.log(colorScale)
                                        //colorScale.range("",d3.schemeRdYlGn[9],d3.schemeRdYlGn[0])

                          tooltiptext = "New Cases: ";
                          legendText = "New Cases"
                          maptitle = "US - Counties - Daily New Cases"

                          heatmaptype = "dailycase"
                          s_legendtext = "New cases"

                          heatmapdata = county_daily_case_data


                          x_heat.domain(heatmapdata.map(function(d) { return parser4d(d.Date); }));

                          y_heat_domain = uniquecounty
                          height_ratio = height_ratio_s * y_heat_domain.length/50
                          height_s = height_ratio*width_s
                          y_heat.range([0, height_s])
                          y_heat.domain(y_heat_domain);
                          //maxheatmap = 50
                          band = 1
                          heatmapScale.domain(d3.range(0,Math.log10(maxDailyCaseUS), band));
                          heatmapScale.range(d3.range(0, 1, band*.8/(Math.log10(maxDailyCaseUS))));
                          //heatmapScale.domain(d3.range(minDailyRatioUS,maxDailyRatioUS, 50));
                          //heatmapScale.range(d3.range(0, 1, 50*.95/(max-minDailyRatioUS)));

                          updateMap(lastday,'');
                          updateLegend();
                          updateHeatmap();
                          linechartdropdown = uniquecountysorted;
                          updateLinechart(linechartdropdown[0]);

                          document.getElementById("slideranimation").style.display = "block";
                          //document.getElementById("linechart").click();
                          document.getElementById("main").style.display = "block";
                        document.getElementById("main").click();
                        }
                else if(factor == factorsList[12]){

                            d3.select("#main").text("Main")
                            d3.select("#linechart").text("Total Cases for Counties")
                            document.getElementById("scatter").style.display = "none";
                            heatmaptitle = "Total Cases for Counties with High Number of Cases"
                            d3.select("#heatmap").text(heatmaptitle)
                            d3.select("#heatmapdesc").text("This heat map provides insight into number of total cases for each County")


                        minmap= Math.log10(d3.min(mapdata, function(d) { return +d.value; }));
                        maxmap = Math.log10(d3.max(mapdata, function(d) { return +d.value; }));

                        colorScale.domain(d3.range(0, maxmap+1, 1));//minmap is infinity
                        colorScale.range(d3.schemeOranges[7]);

                        console.log(colorScale)


                        tooltiptext = "Total Cases: ";
                        legendText = "Total Cases"
                        maptitle = "US - Total Cases"
                        mapjson = topojson.feature(us, us.objects.states).features
                        mapdata = county_total_case_data
                        maptype = 'county'

                        heatmapdata = county_total_case_data
                        heatmaptype = "dailycase"
                        s_legendtext = "Total cases"



                        x_heat.domain(heatmapdata.map(function(d) { return parser4d(d.Date); }));
                        //maxheatmap = 50
                        y_heat_domain = uniquecounty
                        height_ratio = height_ratio_s * y_heat_domain.length/50
                        height_s = height_ratio*width_s
                        y_heat.range([0, height_s])
                        y_heat.domain(y_heat_domain);

                        band = 1
                        maxHmap= Math.log10(d3.max(heatmapdata, function(d) { return +d.value; }));

                        heatmapScale.domain(d3.range(0,maxHmap, band));
                        heatmapScale.range(d3.range(0, 1, band*.8/(maxHmap)));
                        //heatmapScale.domain(d3.range(minDailyRatioUS,maxDailyRatioUS, 50));
                        //heatmapScale.range(d3.range(0, 1, 50*.95/(max-minDailyRatioUS)));
                      updateMap(lastday,'');
                      updateLegend();
                      updateHeatmap();
                      linechartdropdown = uniquecountysorted;
                        updateLinechart(linechartdropdown[0]);

                        document.getElementById("slideranimation").style.display = "block";
                        //document.getElementById("linechart").click();
                        document.getElementById("main").style.display = "block";
                        document.getElementById("main").click();
                    }

                else if(factor == factorsList[20]){

                        clusterdata = "yes"
                        region = 'india'
                        startDate = d3.min(india_daily_case_data, function(d) { return parser(d.Date); });
                        endDate = d3.max(india_daily_case_data, function(d) { return parser(d.Date); });
                        x_line.domain([startDate, endDate]);

                      //    d3.select("#main").text("Main")
                     //     d3.select("#linechart").text("Daily New Cases for State")

                       //   d3.select("#scatter").text("Short Term and Long Term trend")


                      //    d3.select("#heatmap").text(heatmaptitle)
                      //    d3.select("#heatmapdesc").text("This heat map provides insight into how the number of new cases have trended over the period")
                       //   document.getElementById("scatter").style.display = "block";

                          mapdata = us_cases_change_data
                          maptype = 'state'
                          maptitle = " India - Short Term (7 days) and Long Term (14 Days) Trend "
                          mapjson = topojson.feature(us, us.objects.states).features

                          var uniqueCluster = [...new Set( india_cases_change_data.map(item =>+item.risklevel))].sort()
                        // colorScale.domain(['0','1','2','3','4'])
                          colorScale.domain(uniqueCluster);
                        // console.log(colorScale)
                                        //colorScale.range("",d3.schemeRdYlGn[9],d3.schemeRdYlGn[0])
                          colorScale.range(["",d3.interpolateRdYlGn(.2),d3.interpolateRdYlGn(.3),d3.interpolateRdYlGn(.4),d3.interpolateRdYlGn(.6),d3.interpolateGreys(.2)])
                          clusterDesc = ["Not Improving","Short Term Improving","Was Improving but Uptick","Improving or Flat","Low # of Current Cases"]
                          tooltiptext = "Trend: ";
                          legendText = "Trend"

                          /*
                          mapjson.forEach(d => {

                            var mdata = mapdata.filter(function(t){return t.Province_State == d.properties.name ;})

                            //console.log(mdata)
                            if (mdata.length > 0){
                              d.mapvalue = +mdata[0].risklevel
                              d.color = colorScale((+mdata[0].risklevel))
                              d.Date = lastday
                            }// colorScale(Math.log10(d.fact))
                            console.log(d)
                          });
                            */
                          //console.log(mapjson)

                           //     scatterdata = india_cases_change_data
                                //console.log(scatterdata)
                         /*       minx_scatter= 1.1*d3.min(scatterdata, function(d) { return +d.long_term_slope ; });
                                maxx_scatter= 1.1*d3.max(scatterdata, function(d) { return +d.long_term_slope ; });
                                miny_scatter= 1.1*d3.min(scatterdata, function(d) { return +d.short_term_slope ; });
                                maxy_scatter= 1.1*d3.max(scatterdata, function(d) { return +d.short_term_slope ; });

                                x_scatter.domain([minx_scatter, maxx_scatter]);
                                y_scatter.domain([miny_scatter, maxy_scatter]);

                                sc_legend_x = [x_scatter(0),x_scatter(0),x_scatter(minx_scatter), x_scatter(minx_scatter)]
                                console.log(sc_legend_x)
                                sc_legend_y = [y_scatter(maxy_scatter),y_scatter(0),y_scatter(maxy_scatter),y_scatter(0)]
                                sc_legend_Xend = [x_scatter(maxx_scatter),x_scatter(maxx_scatter), x_scatter(0),x_scatter(0)]

                                sc_legend_yend = [y_scatter(0),y_scatter(miny_scatter),y_scatter(0),y_scatter(miny_scatter)]

                                scatter_domain = colorScale.domain().slice(0, 4);

                                minSize = d3.min(scatterdata, function(d) { return +d.avg ; });
                              maxSize = d3.max(scatterdata, function(d) { return +d.avg ; });
                              console.log(minSize, maxSize)
                              sizeLogscale.domain([minSize, maxSize])
                              console.log(minSize, maxSize)
                              scatterdata.forEach(d => {
                                    d.col = colorScale(+d.risklevel)
                                    d.x = x_scatter(+d.long_term_slope)
                                    d.y = y_scatter(+d.short_term_slope)
                                    d.size = sizeLogscale(+d.avg)
                                  })
                                */
                                heatmaptype = "trend"
                                s_legendtext = "% Change in Daily Cases"
                                heatmaptitle = "Trend in New Cases by State"
                                heatmapdata = india_case_data_slope
                                x_heat.domain(heatmapdata.map(function(d) { return parser4d(d.Date); }));

                                y_heat_domain = uniqueIndiaState
                                height_ratio = height_ratio_s * y_heat_domain.length/60
                                console.log(height_s)
                                height_s = height_ratio*width_s- margin_s.top - margin_s.bottom;
                                console.log(height_s)
                                y_heat.range([0, height_s])
                                y_heat.domain(y_heat_domain);

                                maxheatmap = 50
                                band = 10
                                heatmapScale.domain(d3.range(-maxheatmap,maxheatmap+1, band));
                                heatmapScale.range(d3.range(.1, 1, band*.8/(2*maxheatmap)));
                                updateHeatmap();
                              //------
                                heatmapdata =  india_daily_case_data
                                heatmaptype = "dailycase"
                                s_legendtext = "New cases"
                                heatmaptitle = "New Cases by State"

                                x_heat.domain(heatmapdata.map(function(d) { return parser4d(d.Date); }));
                                //maxheatmap = 50
                                y_heat_domain = uniqueIndiaState
                                height_ratio = height_ratio_s * y_heat_domain.length/50
                                height_s = height_ratio*width_s
                                y_heat.range([0, height_s])
                                y_heat.domain(y_heat_domain);

                                band = 1
                                maxHmap= Math.ceil(Math.log10(d3.max(heatmapdata, function(d) { return +d.value; })));

                                heatmapScale.domain(d3.range(0,maxHmap, band));
                                heatmapScale.range(d3.range(0, 1, band*.8/(maxHmap)));
                                //console.log(heatmapdata)
                                updateHeatmap();
                                //---
                                                            //------
                                heatmapdata =  india_total_case_data
                                heatmaptype = "dailycase"
                                s_legendtext = "Total cases"
                                heatmaptitle = "Total Cases by State"

                                x_heat.domain(heatmapdata.map(function(d) { return parser4d(d.Date); }));

                                y_heat_domain = uniqueIndiaState
                                height_ratio = height_ratio_s * y_heat_domain.length/50
                                height_s = height_ratio*width_s
                                y_heat.range([0, height_s])
                                y_heat.domain(y_heat_domain);

                                band = 1
                                maxHmap= Math.ceil(Math.log10(d3.max(heatmapdata, function(d) { return +d.value; })));

                                heatmapScale.domain(d3.range(0,maxHmap, band));
                                heatmapScale.range(d3.range(0, 1, band*.8/(maxHmap)));
                                //console.log(heatmapdata)
                                updateHeatmap();
                                //---
                                //heatmapScale.domain(d3.range(minDailyRatioUS,maxDailyRatioUS, 50));
                                //heatmapScale.range(d3.range(0, 1, 50*.95/(max-minDailyRatioUS)));
                             // updateMap(lastday,'');
                             // updateLegend();
                             scatterdata = india_cases_change_data
                             console.log(india_cases_change_data)
                             scatterdata.forEach(d => {

                                //console.log(d)
                                    d.x = (+d.long_term_slope)
                                    d.y = (+d.short_term_slope)
                                    d.size = (+d.avg)
                                    d.col = colorScale(+d.risklevel)

                                  })
                          updateScatter(scatterdata,
                                          "Short Term (7 days) vs Long Term (14 days) Trend in Daily New Cases",
                                          "Size represents the Daily Average",
                                          "7 days Rate of Change(%) in Daily Number of Cases",
                                          "14 days Rate of Change(%) in Daily Number of Cases","");

                          scatterdata  = india_deaths_change_data
                          scatterdata.forEach(d => {
                            var temp = india_cases_change_data.filter(function (t){ return t.Province_State === d.Province_State })
                              //console.log(temp)
                              if (temp.length>0)   {
                                d.code = temp[0].code
                                        d.x = (+d.long_term_slope)
                                        d.y = (+d.short_term_slope)
                                        d.size = (+d.avg)
                                        d.col = colorScale(+d.risklevel)
                                    }
                                      })

                            updateScatter(scatterdata,
                                          "Short Term (7 days) vs Long Term (14 days) Trend in Daily Deaths",
                                          "Size represents the Daily Average",
                                          "7 days Rate of Change(%) in Daily Deaths",
                                          "14 days Rate of Change(%) in Daily Deaths",
                                          "");


                          scatterdata  = india_deaths_change_data
                         // console.log(scatterdata)
                         // console.log(scatterdata)
                          scatterdata.forEach(d => {
                                        d.x = (+d.total_death)
                                        d.y = (+d.death_rate)
                                        d.size = (+d.avg)
                                        if (d.size <= 0)
                                          {
                                            d.size = 1
                                          }
                                        d.col = colorScale(+d.risklevel)
                                      })
                          updateScatter(scatterdata,
                          "Death Rate (% of Total Cases)",
                            "Size represents the Daily Average",
                              "Death Rate as % of Total Cases",
                              "Total Deaths",
                              "");

                           scatterdata  =  india_case_peak_data
                           var uniqueCluster = [...new Set(scatterdata.map(item =>+item.cluster))].sort()
                    colorScale.domain(['1','2','3','4'])
                    //console.log(uniqueCluster)
                    //colorScale.domain(uniqueCluster);
                      clusterDesc = ["Peaked in last 2 weeks","Below AVG Rate","Above AVG Rate","90% down from Peak"]
                      colorScale.range(["",d3.interpolateSpectral(.10),d3.interpolateSpectral(.25),d3.interpolateSpectral(.7),d3.interpolateSpectral(.85),d3.interpolateGreys(.2)])

                          scatterdata.forEach(d => {
                              var temp = india_cases_change_data.filter(function (t){ return t.Province_State === d.Province_State })
                             // console.log(d)
                              if (temp.length>0)   {
                                d.code = temp[0].code

                                        d.x = (+d.days_since_peak)
                                        d.y = (+d.percent_of_peak)
                                        d.size = (+d.avg)
                                        d.col = colorScale(+d.cluster)
                                      }
                                      })
                         // clusterDesc = ["Peaked in last 2 weeks","Trending down but slowly","Trending down "]


                          updateScatter(scatterdata,
                                          "Current Daily Case count(average) as % of Peak and Days since the Peak",
                                          "Size represents the Daily Average",

                                          "Current Daily Average as % of Peak number of Cases for the State",
                                          "Number of Days since Peak",
                                          "");


                          scatterdata  =  india_death_peak_data
                          scatterdata.forEach(d => {
                              var temp = india_cases_change_data.filter(function (t){ return t.Province_State === d.Province_State })
                              //console.log(temp)
                              if (temp.length>0)   {
                                d.code = temp[0].code

                                        d.x = (+d.days_since_peak)
                                        d.y = (+d.percent_of_peak)
                                        d.size = (+d.avg)
                                        d.col = colorScale(+d.cluster)
                                      }
                                      })
                       //   clusterDesc = ["Peaked in last 2 weeks","Trending down but slowly","Trending down "]
                          var uniqueCluster = [...new Set(scatterdata.map(item =>+item.cluster))].sort()
                    // colorScale.domain(['0','1','2','3','4'])
                      colorScale.domain(uniqueCluster);
                          updateScatter(scatterdata,
                                          "Current Daily Death count(average) as % of Peak and Days since the Peak",
                                          "Size represents the Daily Average",

                                          "Current Daily Average as % of Peak number of Daily Deaths for the States",
                                          "Number of Days since Peak",
                                          "");







                              linechartdropdown = uniqueIndiaStatesorted;
                              updateLinechart(linechartdropdown[0]);

                          document.getElementById("slideranimation").style.display = "none";
                          document.getElementById("scatter").click();
                          document.getElementById("main").style.display = "none";
                          //document.getElementById("main").click();

                        }

                else if(factor == factorsList[25]){

                          clusterdata = "yes"
                          region = 'global'


                       //     d3.select("#main").text("Main")
                        //    d3.select("#linechart").text("Daily New Cases for Countries")

                        //    d3.select("#scatter").text("Short Term and Long Term trend")


                          //  d3.select("#heatmap").text(heatmaptitle)
                         //   d3.select("#heatmapdesc").text("This heat map provides insight into how the number of new cases have trended over the period")
                            document.getElementById("scatter").style.display = "block";

                            mapdata = us_cases_change_data
                            maptype = 'state'
                            maptitle = " India - Short Term (7 days) and Long Term (14 Days) Trend "
                            mapjson = topojson.feature(us, us.objects.states).features

                            var uniqueCluster = [...new Set( global_cases_change_data.map(item =>+item.risklevel))].sort()
                          // colorScale.domain(['0','1','2','3','4'])
                            colorScale.domain(uniqueCluster);
                          // console.log(colorScale)
                                          //colorScale.range("",d3.schemeRdYlGn[9],d3.schemeRdYlGn[0])
                            colorScale.range(["",d3.interpolateRdYlGn(.2),d3.interpolateRdYlGn(.3),d3.interpolateRdYlGn(.4),d3.interpolateRdYlGn(.6),d3.interpolateGreys(.2)])
                            clusterDesc = ["Not Improving","Short Term Improving","Was Improving but Uptick","Improving or Flat","Low # of Current Cases"]
                            tooltiptext = "Trend: ";
                            legendText = "Trend"
                            /*

                                  scatterdata = global_cases_change_data.filter(function (d){return d.avg>200})

                                  console.log(scatterdata)
                                  minx_scatter= 1.1*d3.min(scatterdata, function(d) { return +d.long_term_slope ; });
                                  maxx_scatter= 1.1*d3.max(scatterdata, function(d) { return +d.long_term_slope ; });
                                  miny_scatter= 1.1*d3.min(scatterdata, function(d) { return +d.short_term_slope ; });
                                  maxy_scatter= 1.1*d3.max(scatterdata, function(d) { return +d.short_term_slope ; });

                                  x_scatter.domain([minx_scatter, maxx_scatter]);
                                  y_scatter.domain([miny_scatter, maxy_scatter]);

                                  sc_legend_x = [x_scatter(0),x_scatter(0),x_scatter(minx_scatter), x_scatter(minx_scatter)]
                                  console.log(sc_legend_x)
                                  sc_legend_y = [y_scatter(maxy_scatter),y_scatter(0),y_scatter(maxy_scatter),y_scatter(0)]
                                  sc_legend_Xend = [x_scatter(maxx_scatter),x_scatter(maxx_scatter), x_scatter(0),x_scatter(0)]

                                  sc_legend_yend = [y_scatter(0),y_scatter(miny_scatter),y_scatter(0),y_scatter(miny_scatter)]

                                  scatter_domain = colorScale.domain().slice(0, 4);
                                  minSize = d3.min(scatterdata, function(d) { return +d.avg ; });
                                  maxSize = d3.max(scatterdata, function(d) { return +d.avg ; });
                                  console.log(minSize, maxSize)
                                  sizeLogscale.domain([minSize, maxSize])

                                  scatterdata.forEach(d => {
                                    d.col = colorScale(+d.risklevel)
                                    d.x = x_scatter(+d.long_term_slope)
                                    d.y = y_scatter(+d.short_term_slope)
                                    d.size = sizeLogscale(+d.avg)
                                  })*/
                                  heatmaptype = "trend"
                                  s_legendtext = "% Change in Daily Cases"
                                  heatmaptitle = "Trend in New Cases by Country"
                                  heatmapdata = global_case_data_slope
                                  x_heat.domain(heatmapdata.map(function(d) { return parser4d(d.Date); }));

                                  y_heat_domain = uniqueGlobalState
                                  height_ratio = height_ratio_s * y_heat_domain.length/60
                                  console.log(height_s)
                                  height_s = height_ratio*width_s- margin_s.top - margin_s.bottom;
                                  console.log(height_s)
                                  y_heat.range([0, height_s])
                                  y_heat.domain(y_heat_domain);

                                  maxheatmap = 50
                                  band = 10
                                  heatmapScale.domain(d3.range(-maxheatmap,maxheatmap+1, band));
                                  heatmapScale.range(d3.range(.1, 1, band*.8/(2*maxheatmap)));
                                  updateHeatmap();
                                //------
                                  heatmapdata =  global_daily_case_data
                                  heatmaptype = "dailycase"
                                  s_legendtext = "New cases"
                                  heatmaptitle = "New Cases by Country"

                                  x_heat.domain(heatmapdata.map(function(d) { return parser4d(d.Date); }));
                                  //maxheatmap = 50
                                  y_heat_domain = uniqueGlobalState
                                  height_ratio = height_ratio_s * y_heat_domain.length/50
                                  height_s = height_ratio*width_s
                                  y_heat.range([0, height_s])
                                  y_heat.domain(y_heat_domain);

                                  band = 1
                                  maxHmap= Math.ceil(Math.log10(d3.max(heatmapdata, function(d) { return +d.value; })));

                                  heatmapScale.domain(d3.range(0,maxHmap, band));
                                  heatmapScale.range(d3.range(0, 1, band*.8/(maxHmap)));
                                  //console.log(heatmapdata)
                                  updateHeatmap();
                                  //---
                                                              //------
                                  heatmapdata =  global_total_case_data
                                  heatmaptype = "dailycase"
                                  s_legendtext = "Total cases"
                                  heatmaptitle = "Total Cases by Country"

                                  x_heat.domain(heatmapdata.map(function(d) { return parser4d(d.Date); }));

                                  y_heat_domain = uniqueGlobalState
                                  height_ratio = height_ratio_s * y_heat_domain.length/50
                                  height_s = height_ratio*width_s
                                  y_heat.range([0, height_s])
                                  y_heat.domain(y_heat_domain);

                                  band = 1
                                  maxHmap= Math.ceil(Math.log10(d3.max(heatmapdata, function(d) { return +d.value; })));

                                  heatmapScale.domain(d3.range(0,maxHmap, band));
                                  heatmapScale.range(d3.range(0, 1, band*.8/(maxHmap)));
                                  //console.log(heatmapdata)
                                  updateHeatmap();
                                  //---
                                  //heatmapScale.domain(d3.range(minDailyRatioUS,maxDailyRatioUS, 50));
                                  //heatmapScale.range(d3.range(0, 1, 50*.95/(max-minDailyRatioUS)));
                              // updateMap(lastday,'');
                              // updateLegend();
                              scatterdata = global_cases_change_data.filter(function (d){return d.avg>1000})

                             scatterdata.forEach(d => {
                                    d.x = (+d.long_term_slope)
                                    d.y = (+d.short_term_slope)
                                    d.size = (+d.avg)
                                    d.col = colorScale(+d.risklevel)
                                  })
                          updateScatter(scatterdata,
                                          "Short Term (7 days) vs Long Term (14 days) Trend in Daily New Cases",
                                          "Size represents the Daily Average",
                                          "7 days Rate of Change(%) in Daily Number of Cases",
                                          "14 days Rate of Change(%) in Daily Number of Cases","");

                          scatterdata  = global_deaths_change_data.filter(function (d){return d.avg>50})
                          scatterdata.forEach(d => {
                                        d.x = (+d.long_term_slope)
                                        d.y = (+d.short_term_slope)
                                        d.size = (+d.avg)
                                        d.col = colorScale(+d.risklevel)
                                      })

                            updateScatter(scatterdata,
                                          "Short Term (7 days) vs Long Term (14 days) Trend in Daily Deaths",
                                          "Size represents the Daily Average",
                                          "7 days Rate of Change(%) in Daily Deaths",
                                          "14 days Rate of Change(%) in Daily Deaths",
                                          "");



                        scatterdata  = global_deaths_change_data.filter(function (d){return d.avg>50})
                          //console.log(scatterdata)
                          //console.log(scatterdata)
                          scatterdata.forEach(d => {
                                        d.x = (+d.total_death)
                                        d.y = (+d.death_rate)
                                        d.size = (+d.avg)
                                        if (d.size <= 0)
                                          {
                                            d.size = 1
                                          }
                                        d.col = colorScale(+d.risklevel)
                                      })
                          updateScatter(scatterdata,
                          "Death Rate (% of Total Cases)",
                            "Size represents the Daily Average",
                              "Death Rate as % of Total Cases",
                              "Total Deaths(Log Scale)",
                              "");

                        clusterDesc = ["Peaked in last 2 weeks","Below AVG Rate","Above AVG Rate","90% down from Peak"]
                    colorScale.range(["",d3.interpolateSpectral(.10),d3.interpolateSpectral(.25),d3.interpolateSpectral(.7),d3.interpolateSpectral(.85),d3.interpolateGreys(.2)])

                          scatterdata  =  global_case_peak_data.filter(function (d){return d.avg>200})
                          scatterdata.forEach(d => {
                              var temp = global_cases_change_data.filter(function (t){ return t.Province_State === d.Province_State })
                              //console.log(temp)
                              if (temp.length>0)   {
                                d.code = temp[0].code

                                        d.x = (+d.days_since_peak)
                                        d.y = (+d.percent_of_peak)
                                        d.size = (+d.avg)
                                        d.col = colorScale(+d.cluster)
                                      }
                                      })
                         // clusterDesc = ["Peaked in last 2 weeks","Trending down but slowly","Trending down "]
                          var uniqueCluster = [...new Set(scatterdata.map(item =>+item.cluster))].sort()
                    // colorScale.domain(['0','1','2','3','4'])
                      colorScale.domain(uniqueCluster);

                      updateScatter(scatterdata,
                                          "Current Daily Case count(average) as % of Peak and Days since the Peak",
                                          "Size represents the Daily Average",

                                          "Current Daily Average as % of Peak number of Cases for the Countries",
                                          "Number of Days since Peak",
                                          "");


                          scatterdata  =  global_death_peak_data//.filter(function (d){return d.avg>10})
                          scatterdata.forEach(d => {
                              var temp = global_deaths_change_data.filter(function (t){ return t.Province_State === d.Province_State })
                              //console.log(temp)
                              if (temp.length>0)   {
                                d.code = temp[0].code

                                        d.x = (+d.days_since_peak)
                                        d.y = (+d.percent_of_peak)
                                        d.size = (+d.avg)
                                        d.col = colorScale(+d.cluster)
                                      }
                                      })
                      //    clusterDesc = ["Peaked in last 2 weeks","Trending down but slowly","Trending down "]
                          var uniqueCluster = [...new Set(scatterdata.map(item =>+item.cluster))].sort()
                    // colorScale.domain(['0','1','2','3','4'])
                      colorScale.domain(uniqueCluster);
                          updateScatter(scatterdata,
                                          "Current Daily Death count(average) as % of Peak and Days since the Peak",
                                          "Size represents the Daily Average",

                                          "Current Daily Average as % of Peak number of Daily Deaths for the Countries",
                                          "Number of Days since Peak",
                                          "");



                                linechartdropdown = uniqueGlobalStatesorted;
                                updateLinechart(linechartdropdown[0]);

                            document.getElementById("slideranimation").style.display = "none";
                            document.getElementById("scatter").click();
                            document.getElementById("main").style.display = "none";
                            //document.getElementById("main").click();

                  }

        }

        var dropDown = d3.select("#dropdown-container")
                        .append("select")
                        .attr("id","dropdown")
                        .attr("text-anchor", "middle")
                        .style("alignment-baseline", "start")
                        .on("change", dropdownChange);
                       // .on("change", ;

        var options = dropDown.selectAll("option")
                .data(dropdownlist)
                .enter()
                .append("option");
        options.text(function(d) {
                    return d;
                })
                .attr("value", function(d) {
                    return d;
                })
                .property("selected", function(d){
                    return d == factorsList[0];
                })
                ;

    var tip = d3.tip()
          .attr('class', 'd3-tip')
          .offset([120*scale, 180*scale])
          .html(function(d) {
          // console.log(d)
          //console.log(clusterdata)
            if (d.type == 'scatter'){

                return  d.Province_State + "<br/>"
                        +"X value: " + d.x + "<br/>"
                        +"Y value: " + d.y + "<br/>"
                       /*   +"Daily Rate of Change:" + "<br/>"
                          +"Short Term : " + d.short_term_slope + "%" + "<br/>"
                          + "Long Term : " + d.long_term_slope + "%" */
                  // return  "State: "+d.properties.name + "<br/>"  + tooltiptext+ clusterDesc[d.fact-1]

                }
            else if (d.type == 'heatmap' | d.type == 'linechart' ){
                return   d.Province_State + "<br/>" + "Date: "+d.Date+ "<br/>" + tooltiptext+ d.fact ;

               }

            else if(d.type='map') {
              if (clusterdata == 'yes'){

               // console.log("inside tip")
               return   d.properties.name+ "<br/>"
                          +"Daily Rate of Change:" + "<br/>"
                          +"Short Term : " + d.short_term_slope + "%" + "<br/>"
                          + "Long Term : " + d.long_term_slope + "%"

              }

              else{

                return  d.properties.name + "<br/>" + "Date: "+d.Date+ "<br/>" + tooltiptext+ d.fact ;
              }
            }
        });

//slider
    slider.append("line")
      .attr("class", "track")
      .attr("x1", x_slider.range()[0])
      .attr("x2", x_slider.range()[1])
      .select(function() { return this.parentNode.appendChild(this.cloneNode(true)); })
      .attr("class", "track-inset")
      .select(function() { return this.parentNode.appendChild(this.cloneNode(true)); })
      .attr("class", "track-overlay")
      .call(d3.drag()
          .on("start.interrupt", function() { slider.interrupt(); })
          .on("start drag", function() {
            currentValue = d3.event.x;
            update(x_slider.invert(currentValue));
          })
      );
      slider.insert("g", ".track-overlay")
      .attr("class", "ticks")
      .attr("transform", "translate(0," + 12 + ")")
    .selectAll("text")
      .data(x_slider.ticks(5))
      .enter()
      .append("text")
      .attr("x", x_slider)
      .attr("y", 10)
      .attr("text-anchor", "end")
      .text(function(d) { return formatDate(d); });
    var handle = slider.insert("circle", ".track-overlay")
      .attr("class", "handle")
      .attr("r", 9);

    var label = slider.append("text")
      .attr("class", "label")
      .attr("text-anchor", "middle")
      .text(formatDate(startDate))
      .attr("transform", "translate(0," + (-25) + ")")
      // draw intially
    //console.log(factor)
  dropdownChange()
  //updateMap("2016");
  //updateLegend();
////--------------update on play
    playButton
        .on("click", function() {
        //console.log("inside click)")
        var button = d3.select(this);
        if (button.text() == "Pause") {
        moving = false;
        clearInterval(timer);
        // timer = 0;
        button.text("Play");
        } else {
        moving = true;
          if (maptype =='county'){
            timer = setInterval(step, 100);
          }
          else{
          timer = setInterval(step, 30);
          }
        button.text("Pause");
        }
        console.log("Slider moving: " + moving);
    })
    function step() {
      //console.log("current value", currentValue,x.invert(currentValue))
      update(x_slider.invert(currentValue));
      currentValue = currentValue + (7*targetValue/interval);
      if (currentValue > targetValue) {
          moving = false;
          currentValue = 0;
          clearInterval(timer);
          // timer = 0;
          playButton.text("Play");
          console.log("Slider moving: " + moving);
      }
    }

    function update(h) {
    // update position and text of label according to slider scale
      handle.attr("cx", x_slider(h));
      label
          .attr("x", x_slider(h))
          .text(formatDate(h));
      // filter data set and redraw plot
     // console.log("..............inside update")
      //console.log(factor)
      console.log(formatDate_mdy(h))
      updateMap(formatDate_mdy(h),'slider')
    }

// --------------------------------------------------draw map
    sdata = []
  function updateMap(fordate,callingSource){
    //var count
    svg.call(tip)
    // console.log("~~~~~~~~~~");
      //console.log(factor)
      if (maptype == 'county')
      {
        mapjson = topojson.feature(us_counties, us_counties.objects.counties).features
        mapdata.forEach(d => {
          d.FIPS = FIPS(+d.FIPS)
        map_path = path1
        region = "county"
        //console.log(d.FIPS)
      });
      }
      else{
        mapjson = topojson.feature(us, us.objects.states).features
        map_path = path
        region = "states"
      }
      svg.append("g")
          .attr("class", region)
          //.attr("transform", "translate(" + -margin.left + "," + -margin.top + ")")
          .selectAll("path")
          .data(mapjson)
          .enter().append("path")
          .attr("fill", function(d) {
            d.Date = fordate
              if (maptype == 'county'){
                  var sdata = mapdata.filter(function(t){return t.FIPS == d.id ;})

                  if (sdata.length > 0) {
                    d.county = sdata[0].Province_State
                   // console.log(d.id)
                    //count = count + 1
                   // console.log(count)
                    if(factor == factorsList[10]){
                      d.fact = +sdata[0].risklevel
                      var col = colorScale(d.fact)
                      d.long_term_slope = +sdata[0].long_term_slope
                      d.short_term_slope = +sdata[0].short_term_slope
                    }
                    else if (factor == factorsList[11]|factor == factorsList[12] ){
                      var sdata = mapdata.filter(function(t){return t.FIPS == d.id && t.Date == fordate;})
                      d.fact = +sdata[0].value
                      var col = colorScale(Math.log10(d.fact))
                    }
                  }
              }
              else{

                  var sdata = mapdata.filter(function(t){return t.Province_State == d.properties.name ;})
                  if (sdata.length > 0){
                    if(factor == factorsList[0]){
                    d.fact = +sdata[0].risklevel
                    d.long_term_slope = +sdata[0].long_term_slope
                    d.short_term_slope = +sdata[0].short_term_slope

                    var col = colorScale(d.fact)
                    }
                    else if (factor == factorsList[1]|factor == factorsList[2] ){
                      var sdata = mapdata.filter(function(t){return t.Province_State == d.properties.name && t.Date == fordate;})
                      d.fact = +sdata[0].value
                      var col = colorScale(Math.log10(d.fact))
                    }
                  else{
                    console.log(d.id)
                    d.fact = 0
                  }
                 }
              }
              if (col) {
                return col
              } else {
                return '#ffffff'
              }
            })
        .attr("d", map_path)
        .attr("width", width)
        .attr("height", height)
        .on('mouseover',function(d){
        d.type='map'
         tip.show(d)
          d3.select(this).transition().duration(300).style("opacity", 0.8);
        })
        .on('mouseout', function(d){
          tip.hide(d)
        d3.select(this).transition().duration(300).style("opacity", 1);
            }
        )
        .on('click',showstatetrend)
        .append("title") ;

      if (maptitle!= ""){
        maptitlecombined = maptitle + " - "+ fordate
      }
      else{
        maptitlecombined = factor
      }

    svg.selectAll("text.maptitle").remove();
        // title
    svg.append("text")
      .attr("class", "maptitle")
        .attr("x", width/2)
        .attr("y", margin.top/3)
        //.attr("dy", ".35em")
        .attr("text-anchor", "middle")
        .style("font-size", 25*scale+"px")
        .style("font-family", "avenir next")
        .style("fill", "#696969")
        .style("font-weight", "bold")
      //  .style("text-decoration", "underline")
        //.text(String);
        .text(maptitlecombined);
   // console.log("-----------!!!!!!!---------")
    //console.log(count)
    }
  function updateLegend(){
    //console.log(factor)
   // d3.selectAll("g.legend").remove();
    var legendX = (width*.82),
      legendY = height/2.25;
   //console.log(scale,width)
    svg.selectAll("g.legend").remove();
    svg.selectAll("text.legend").remove();
    svg.append("text")
      .attr("class", "legend")
        .attr("x", legendX)
        .attr("y", legendY-10*scale)
        .attr("font-size",15*scale)
        .attr("text-anchor", "start")
       // .attr("font-weight","bold")
        //.text(String);
        .text(legendText);

    var legendUpdate = svg.selectAll("g.legend")
        .data(colorScale.domain());
    //console.log(colorScale.domain())
    var legendEnter = legendUpdate.enter().append("g")
        .attr("class", "legend")
        .attr("id",function(d){
            return d})
        .attr("transform", function(d, i) { return "translate(" + (legendX ) + "," + (legendY+ i*30*scale ) + ")"; });

    var legendExit = legendUpdate.exit();
    legendExit.remove()
    legendUpdate.merge(legendEnter)
        .append("rect")
        .attr("width", 20*scale)
        .attr("height", 30*scale)
        .style("fill", function(d){
                 return (colorScale(d))});
    legendUpdate.merge(legendEnter)
        .append("text")
        .attr("x", 25*scale)
        .attr("y", 18*scale)
        //.attr("dy", ".35em")
        .attr("font-size",14*scale)
        .attr("text-anchor", "start")
        //.text(String);
        .text(function(d,i){

          if (clusterdata == "yes"){
           // console.log(d,i)
              return clusterDesc[d-1]

          }
          else if (clusterdata=="change")
          {
            return legendDesctext[i]
          }
          else if (factor == factorsList[1]|factor == factorsList[2]|factor == factorsList[11]|factor == factorsList[12]){
            return Math.pow(10,d)
          }
          else{
            return Math.round((d))
          }
        });
  }

  function updateLegendScatter(SVG_parent, legendX, legendY){
    //console.log(factor)
   // d3.selectAll("g.legend").remove();
   // var legendX = (width*.82),
   //   legendY = height/2.25;
   //console.log(scale,width)
    SVG_parent.selectAll("g.legend").remove();
    SVG_parent.selectAll("text.legend").remove();
    SVG_parent.append("text")
      .attr("class", "legend")
        .attr("x", legendX)
        .attr("y", legendY-20*scale)
        .attr("font-size",15*scale)
        .attr("text-anchor", "start")
       // .attr("font-weight","bold")
        //.text(String);
        .text(legendText);

    var legendUpdate = SVG_parent.selectAll("g.legend")
        .data(colorScale.domain());
    //console.log(colorScale.domain())
    var legendEnter = legendUpdate.enter().append("g")
        .attr("class", "legend")
        .attr("id",function(d){
            return d})
        .attr("transform", function(d, i) { return "translate(" + (legendX ) + "," + (legendY+ i*20*scale ) + ")"; });

    var legendExit = legendUpdate.exit();
    legendExit.remove()
    legendUpdate.merge(legendEnter)
        //.append("rect")
        .append("circle")
        .attr("r",6*scale)
      //
      //  .attr("width", 20*scale)
      //  .attr("height", 30*scale)
        .style("fill", function(d){
                 return (colorScale(d))});
    legendUpdate.merge(legendEnter)
        .append("text")
        .attr("x", 15*scale)
        .attr("y", 6*scale)//30*scale)
        //.attr("dy", ".35em")
        .attr("font-size",14*scale)
        .attr("text-anchor", "start")
        //.text(String);
        .text(function(d,i){

          if (clusterdata == "yes"){
           // console.log(d,i)
              return clusterDesc[d-1]

          }
          else if (clusterdata=="change")
          {
            return legendDesctext[i]
          }
          else if (factor == factorsList[1]|factor == factorsList[2]|factor == factorsList[11]|factor == factorsList[12]){
            return Math.pow(10,d)
          }
          else{
            return Math.round((d))
          }
        });
  }


  //---------------------------------------------on click of state

  function showstatetrend(d){
     // console.log(factor)
     // console.log(d)
        //document.getElementById("details").style.display = "block";
        document.getElementById("linechart").click();
        d3.select("#chart1").selectAll("svg").remove();
        //d3.select("#chart2").select("svg").remove();
        //d3.select("#chart3").select("svg").remove();
                    //d3.select("#seasonal").remove();

            if (d.type == 'scatter'| d.type== 'heatmap'){

              var st = d.Province_State;

            }
            else {
              if (maptype == 'county'){
                    var st = d.county
              }
              else{

                    var st = d.properties.name;
                }
              }
            console.log(st)
            updateLinechart(st)

  }
  // ---- Line Chart functions
  function updateLinechart(st){
     // console.log(factor)
     // console.log(st)
      d3.select("#stdropdown").remove()

      var statedropDown = d3.select("#state-dropdown-container")
                        .append("select")
                        .attr("id","stdropdown")
                        .attr("text-anchor", "middle")
                        .style("alignment-baseline", "start")
                        .on("change", statedropdownChange);
       //console.log(uniquestate)
        var stateoptions = statedropDown.selectAll("option")
                //.data(uniquestatesorted)
                  .data(linechartdropdown)
                .enter()
                .append("option");

            stateoptions.text(function(d) {
                    return d;
                })
                .attr("value", function(d) {
                    return d;
                })
                .property("selected", function(d){
                    return d == st
                    //d == linechartdropdown[0];
                })
                ;
      if (factor == factorsList[0] || factor == factorsList[1] || factor == factorsList[2]){
            linemaptype = "casecount"
            linelegendtext = "Daily New Cases"
            yaxislabel = ""
            //mins = 0
            //maxs = maxDailyCase
            var dailycase = us_daily_case_data.filter(function(t){return t.Province_State == st }).sort(function(a, b){ return d3.ascending(parser(a.Date), parser(b.Date)); })
                dailydeath = us_daily_death_data.filter(function(t){return t.Province_State == st }).sort(function(a, b){ return d3.ascending(parser(a.Date), parser(b.Date)); })
                totalcase = us_total_case_data.filter(function(t){return t.Province_State == st }).sort(function(a, b){ return d3.ascending(parser(a.Date), parser(b.Date)); })
                totaldeath = us_total_death_data.filter(function(t){return t.Province_State == st }).sort(function(a, b){ return d3.ascending(parser(a.Date), parser(b.Date)); })

              }
            else if(factor == factorsList[10]|| factor == factorsList[11] || factor == factorsList[12]){
                var dailycase = county_daily_case_data.filter(function(t){return t.Province_State == st }).sort(function(a, b){ return d3.ascending(parser(a.Date), parser(b.Date)); })
                dailydeath = county_daily_death_data.filter(function(t){return t.Province_State == st }).sort(function(a, b){ return d3.ascending(parser(a.Date), parser(b.Date)); })
                totalcase = county_total_case_data.filter(function(t){return t.Province_State == st }).sort(function(a, b){ return d3.ascending(parser(a.Date), parser(b.Date)); })
                totaldeath = county_total_death_data.filter(function(t){return t.Province_State == st }).sort(function(a, b){ return d3.ascending(parser(a.Date), parser(b.Date)); })

              }
            else if(factor == factorsList[20]){

                var dailycase = india_daily_case_data.filter(function(t){return t.Province_State == st }).sort(function(a, b){ return d3.ascending(parser(a.Date), parser(b.Date)); })
                dailydeath = india_daily_death_data.filter(function(t){return t.Province_State == st }).sort(function(a, b){ return d3.ascending(parser(a.Date), parser(b.Date)); })
                totalcase = india_total_case_data.filter(function(t){return t.Province_State == st }).sort(function(a, b){ return d3.ascending(parser(a.Date), parser(b.Date)); })
                totaldeath = india_total_death_data.filter(function(t){return t.Province_State == st }).sort(function(a, b){ return d3.ascending(parser(a.Date), parser(b.Date)); })


            }
            else if(factor == factorsList[25]){

                var dailycase = global_daily_case_data.filter(function(t){return t.Province_State == st }).sort(function(a, b){ return d3.ascending(parser(a.Date), parser(b.Date)); })
                dailydeath = global_daily_death_data.filter(function(t){return t.Province_State == st }).sort(function(a, b){ return d3.ascending(parser(a.Date), parser(b.Date)); })
                totalcase = global_total_case_data.filter(function(t){return t.Province_State == st }).sort(function(a, b){ return d3.ascending(parser(a.Date), parser(b.Date)); })
                totaldeath = global_total_death_data.filter(function(t){return t.Province_State == st }).sort(function(a, b){ return d3.ascending(parser(a.Date), parser(b.Date)); })

            }
            //console.log(dailyLine)
            createLineChart(dailycase, "Daily New Cases", "orange","","",'avg')
            createLineChart(totalcase, "Total Cases", "red","","",'')
            createLineChart(dailydeath, "Daily Deaths", "gray","","",'avg')
            createLineChart(totaldeath, "Total Deaths", "darkgray","","",'')

            //---------------------------------------Line Chart
    function createLineChart(dailyLine, title, linecolor,xscale_type, yscale_type,avg)  {
          var y_line_scale
          //console.log(dailyLine)
              miny = d3.min(dailyLine, function(d) { return +d.value; });
              maxy = 1.1*d3.max(dailyLine, function(d) { return +d.value; });

            if (yscale_type == "log"){

              miny = 1
              y_lineLog.domain([miny,maxy])
              y_line_scale = y_lineLog
            }
            else
            {

              miny = 0
              y_line.domain([miny,maxy])
              y_barScale.domain([miny,maxy])
              y_line_scale = y_line
            }

           // console.log(miny, maxy)

            y_line_scale.domain([miny,maxy])
           // console.log(maxy, y_line_scale(maxy))
          //var gridlinerange = d3.range(miny, maxy, (maxy-miny)/10)

          var svg_y = d3.select("#chart1")
            .append("svg")
            .attr("class","line-plot")
                .attr("width", width_l + margin_l.left + margin_l.right)
                .attr("height", height_l + margin_l.top + margin_l.bottom)
                .append("g")
                .attr("transform", "translate(" + margin_s.left + "," + margin_s.top + ")");

          var line1 = d3.line()
            .x(function(d, i) { return x_line(parser(d.Date)); }) // set the x values for the line generator
            .y(function(d) {
            //if(linemaptype == "casecount"){
             //console.log(+d.value)
              //console.log(y_line_scale(+d.value))
              return y_line_scale(+d.value);
           // }

            })
            var line2 = d3.line()
            .x(function(d, i) { return x_line(parser(d.Date)); }) // set the x values for the line generator
            .y(function(d) {
            //if(linemaptype == "casecount"){
              //console.log(+d.value)
              //console.log(y_line_scale(+d.value))
              return y_line_scale(+d.movAvg);
           // }

            })


            //console.log(movingresult)

            // set the y values for the line generator
            // .curve(d3.curveMonotoneX) // apply smoothing to the line


            //Define Y axis
            var yAxis = d3.axisLeft()
            .scale(y_line_scale)
            .ticks(5)
            .tickSizeOuter(0);

            var xAxis = d3.axisBottom()
                    .scale(x_line)
                    //.tickValues(x_line.domain().filter((d, i) => d % 10 === 0))
                    .ticks(d3.scaleTime.week, 2)
                  // .tickValues(x_line.domain().filter(function(d, i) {return !(i%7);}))
                .tickFormat(d3.timeFormat('%m/%d'))
                    .tickSizeOuter(0);

            // gridlines in x axis function
                function make_x_gridlines() {
                    return d3.axisBottom(x_line)
                        .ticks(5)
                      .tickValues(x_line.domain().filter((d, i) => d % 7 === 0))
                      .tickSizeOuter(0)
                }
                // gridlines in y axis function
                function make_y_gridlines() {
                    return d3.axisLeft(y_line_scale)
                  // .tickPadding(5)
                    .ticks(5  )
                    //.tickValues(gridlinerange)
                    .tickSizeOuter(0)
                }
            //         console.log(x_line.domain().filter((d, i) => d % 10 === 0))
            //console.log(y_line.domain())
            //dailyLineHist = dailyLine.filter((function(t){return t.year <= 2016 }))
            dailyLineHist = dailyLine
            //console.log(dailyLineHist)

          if (avg == 'avg')
          {

            x_barScale.domain(dailyLineHist.map(function(d) { return parser(d.Date); }));
            //y_barScale.domain([0, d3.max(dailyLineHist, function(d) { return +d.value; })]);

            movingAvgValues = movingAverage(dailyLine.map(d => +d.value), 7)
            uniqueday_data = [...new Set(dailyLine.map(item =>item.Date))]

            var movingresult = [];
                      uniqueday_data.forEach(function(date, i){
                       // console.log(date,i)
                          if (!Number.isNaN(movingAvgValues[i])){
                           // console.log(movingAvgValues[i])
                          movingresult.push({
                              Date : date, movAvg : movingAvgValues[i]
                          })
                      }
                      })
                     // console.log(movingresult)
            svg_y.selectAll(".bar")
            .data(dailyLineHist)
            .enter().append("rect")
            .attr("class", "bar")
            .style("fill", linecolor)
            .attr("x", function(d) { return x_barScale(parser(d.Date)); })
            .attr("y", function(d) { return y_barScale(+d.value); })
            .attr("width", x_barScale.bandwidth())
            .attr("height", function(d) { return height_l-y_barScale(+d.value); });



              svg_y.append("path")
                  .datum(movingresult) //  Binds data to the line
                  .attr("class", "line") // Assign a class for styling
                  .style('stroke','red')
                  .style("stroke-width",2)
                  /*
                  .style("stroke-dasharray",function(d){
                  console.log(d)

                  }
                  )*/
                  .style('fill',"none")
                  //.attr("fake",function(d){console.log(d)})
                  .attr("d", line2)
                  ;
          }
          else
          {
            svg_y.append("path")
            .datum(dailyLineHist) //  Binds data to the line
            .attr("class", "line") // Assign a class for styling
            .style('stroke',linecolor)
            .style("stroke-width",2)
            /*
            .style("stroke-dasharray",function(d){
            console.log(d)

            }
            )*/
            .style('fill',"none")
            //.attr("fake",function(d){console.log(d)})
            .attr("d", line1)
            ;
          }
            /*
            var focus = svg.append("g")
            .attr("class", "focus")
            .style("display", "none");

        focus.append("circle")
            .attr("r", 5);

        focus.append("rect")
            .attr("class", "tooltip")
            .attr("width", 100)
            .attr("height", 50)
            .attr("x", 10)
            .attr("y", -22)
            .attr("rx", 4)
            .attr("ry", 4);

        focus.append("text")
            .attr("class", "tooltip-date")
            .attr("x", 18)
            .attr("y", -2);

        focus.append("text")
            .attr("x", 18)
            .attr("y", 18)
            .text("Likes:");

        focus.append("text")
            .attr("class", "tooltip-likes")
            .attr("x", 60)
            .attr("y", 18);

        svg.append("rect")
            .attr("class", "overlay")
            .attr("width", width)
            .attr("height", height)
            .on("mouseover", function() { focus.style("display", null); })
            .on("mouseout", function() { focus.style("display", "none"); })
            .on("mousemove", mousemove);

        function mousemove() {
            var x0 = x_line.invert(d3.mouse(this)[0]),
                i = bisectDate(dailyLineHist, x0, 1),
                d0 = dailyLineHist[i - 1],
                d1 = dailyLineHist[i],
                d = x0 - d0.Date > d1.Date - x0 ? d1 : d0;
            focus.attr("transform", "translate(" + x_line(parser(d.Date)) + "," + y_line(d.value) + ")");
            focus.select(".tooltip-date").text(d.Date);
            focus.select(".tooltip-likes").text(formatValue(d.value));
        }*/


            //Create X axis
            svg_y.append("g")
            .attr("class", "axis")
            .attr("transform", "translate(0," + height_l + ")")
            //.attr("transform", "translate(" + margin.left + "," + margin.top + ")")
            .call(xAxis);
            //Create Y axis
            svg_y.append("g")
            .attr("class", "axis")
            // .attr("transform", "translate(" + padding + ",0)")
            .call(yAxis);
            // add the X gridlines
            svg_y.append("g")
            .attr("class", "grid")
            .attr("transform", "translate(0," + height_l + ")")
            .call(make_x_gridlines()
            .tickSize(-height_l)
            .tickFormat("")
            )
            // add the Y gridlines
            svg_y.append("g")
            .attr("class", "grid")
            .call(make_y_gridlines()
            .tickSize(-width_l)
            .tickFormat("")
            )

            // Add the title:
            svg_y.append("text")
            .attr("x", (width_l / 2))
            .attr("y", -margin_s.top/2)
            .attr("text-anchor", "middle")
            .attr("class", "title")
            .style("font-size", 25*scale+"px")
            .style("font-family", "avenir next")
            .style("fill", "#696969")
            .style("font-weight", "bold")
            .text(title +" - " + st);
            // apply the reults of the least squares regression
      /*
            svg_y.append("text")
            .attr("x", width_l*.05-10)
            .attr("y", height_l+(50*scale))
            .attr("text-anchor", "start")
            .attr("class", "sttitle")
            .style("font-size", 20*scale+"px")
            .style("font-family", "Avenir")
            .style("fill", "black")
            .style("text-decoration", "underline")
            .text(linelegendtext);              // Add the TEMP CHANGE:


            // Add the State Legend:
            svg_y.append("text")
            .attr("x", width_l*.05)
            .attr("y", height_l+(70*scale))
            .attr("text-anchor", "start")
            .attr("class", "legendst")
            .style("font-size", 20*scale+"px")
            .style("font-family", "Avenir")
            .style("fill", linecolor)
            .text(st);
            */
          }


    }

    //---state dropdown change
    var statedropdownChange = function(){
      d3.select("#chart1").selectAll("svg").remove();
      d3.select("#stdropdown").remove()
              console.log("instate drop down")
              newstate = d3.select(this).property('value');
              updateLinechart(newstate)

    }
    // Scatter / heat Map

    function updateScatter(scatterdata, title, title2,  xAxisLabel, yAxisLabel, xscale_type){
  //-------------------------------------Scatter Plot
      var  random = d3.randomUniform(-7, 7);
      if (xscale_type == "log"){

        minx_scatter= (1.1*d3.min(scatterdata, function(d) { return +d.x ; }));
        maxx_scatter= (1.1*d3.max(scatterdata, function(d) { return +d.x ; }));
        if (minx_scatter>0)
        {
          minx_scatter =1
        }
        sc_scale = x_scatterLog
      }
      else{
         sc_scale = x_scatter
         minx_scatter= 1.1*d3.min(scatterdata, function(d) { return +d.x ; });
          maxx_scatter= 1.1*d3.max(scatterdata, function(d) { return +d.x ; });
          if (minx_scatter>0)
        {
          minx_scatter =0
        }
       }

      //console.log(scatterdata)
      miny_scatter= 1.1*d3.min(scatterdata, function(d) { return +d.y ; });
      maxy_scatter= 1.1*d3.max(scatterdata, function(d) { return +d.y ; });
      //console.log(minx_scatter, maxx_scatter)

      if (miny_scatter>0)
      {
        miny_scatter =0
      }

      //x_scatter.domain([minx_scatter, maxx_scatter]);
      sc_scale.domain([minx_scatter, maxx_scatter]);
      //console.log(minx_scatter, maxx_scatter)
      y_scatter.domain([miny_scatter, maxy_scatter]);

      //sc_legend_x = [x_scatter(0),x_scatter(0),x_scatter(minx_scatter), x_scatter(minx_scatter)]
      //console.log(sc_legend_x)
      //sc_legend_y = [y_scatter(maxy_scatter),y_scatter(0),y_scatter(maxy_scatter),y_scatter(0)]
      //sc_legend_Xend = [x_scatter(maxx_scatter),x_scatter(maxx_scatter), x_scatter(0),x_scatter(0)]

      //sc_legend_yend = [y_scatter(0),y_scatter(miny_scatter),y_scatter(0),y_scatter(miny_scatter)]

      scatter_domain = colorScale.domain().slice(0, 4);

      minSize = d3.min(scatterdata, function(d) { return +d.avg ; });
      maxSize = d3.max(scatterdata, function(d) { return +d.avg ; });
      //console.log(minSize, maxSize)
      sizeLogscale.domain([minSize, maxSize])
     // console.log(500, sc_scale(500))


    var svg_sc = d3.select("#chart3")
                    .append("svg")
                        .attr("width", width_l + margin_l.left + margin_l.right)
                        .attr("height", height_l + margin_l.top + margin_l.bottom)
                        .attr("class","scatter-plot")
                        .append("g")
                        .attr("transform", "translate(" + margin_l.left + "," + margin_l.top + ")");

                      svg_sc.selectAll(".dot")
                              .data(scatterdata)
                            .enter().append("circle")
                              .attr("class", "dot")
                             //.attr('r',5)
                             .attr("r",function(d){
                               //console.log(d)
                                //return sizeLogscale(+d.avg)
                                return sizeLogscale(d.size)
                              })
                              .attr("cx", function(d){
                                //console.log(d)
                                //return x_scatter(+d.long_term_slope)
                                //return x_scatter(d.x)
                                return sc_scale(+d.x)
                              })
                              .attr("cy", function(d){
                                  //return y_scatter(+d.short_term_slope)
                                  return y_scatter(d.y)
                              })
                              .on('mouseover',function(d){
                                d.type = 'scatter'

                                tip.show(d)

                                d3.select(this).transition().duration(300).style("opacity", 0.8);
                              })
                              .on('mouseout', function(d){
                                tip.hide(d)
                              d3.select(this).transition().duration(300).style("opacity", 1);
                                  }
                              )
                              .on('click',showstatetrend)
                              //.style('stroke-width',2)
                             // .style('stroke','black')
                             // .style('fill','lightblue')
                              .style('fill',function(d){
                                  //return colorScale(+d.risklevel)
                                    return d.col
                              });
                      //console.log(scatterdata)
                      if (maptype != 'county'){
                          svg_sc.selectAll("text")
                              .data(scatterdata)
                            .enter().append("text")
                             // .attr("class", "dot")
                             // .attr("r", 3.5)
                              .attr("x", function(d){
                               //console.log(d)
                                return sc_scale(+d.x) +random()
                              })
                              .attr("y", function(d){

                                //console.log(random())

                                  return y_scatter(+d.y) +random()
                              })
                              .text(function(d){
                                if ( region == ''){
                                  return d.Province_State
                                }
                                else{
                                  return d.code
                                }
                              })
                            }


         //Define Y axis
            var yAxis_sc = d3.axisLeft()
                    .scale(y_scatter)
                    .ticks(5)
                    .tickSizeOuter(0);
            var yAxis_sc_m = d3.axisLeft()
                    .scale(y_scatter)
                    .ticks(0)
                    .tickSizeOuter(0);

            var xAxis_sc = d3.axisBottom()
                            .scale(sc_scale)
                            .ticks(5)
                            //.tickValues(x_line.domain().filter((d, i) => d % 5 === 0))
                           // .ticks(d3.scaleTime.week, 2)
                           // .tickValues(x_line.domain().filter(function(d, i) {return !(i%7);}))
                       // .tickFormat(d3.timeFormat('%m/%d'))
                            .tickSizeOuter(0);
          var xAxis_sc_m = d3.axisBottom()
                            .scale(sc_scale)
                            .ticks(0)
                            //.tickValues(x_line.domain().filter((d, i) => d % 5 === 0))
                           // .ticks(d3.scaleTime.week, 2)
                           // .tickValues(x_line.domain().filter(function(d, i) {return !(i%7);}))
                       // .tickFormat(d3.timeFormat('%m/%d'))
                            .tickSizeOuter(0);
            // gridlines in x axis function
                      function make_x_gridlines_sc() {
                            return d3.axisBottom(sc_scale)
                                .ticks(5)
                             //  .tickValues(x_line.domain().filter((d, i) => d % 7 === 0))
                               .tickSizeOuter(0)

                        }
                        // gridlines in y axis function
                        function make_y_gridlines_sc() {
                            return d3.axisLeft(y_scatter)
                           // .tickPadding(5)
                            .ticks(5 )
                            //.tickValues(gridlinerange)
                            .tickSizeOuter(0)

                        }
             //Create X axis
             svg_sc.append("g")
                    .attr("class", "axis")
                    .attr('transform', 'translate(0,' + (y_scatter(0)) + ')')

                    //.attr("transform", "translate(0," + height_l + ")")
                    //.attr("transform", "translate(" + margin.left + "," + margin.top + ")")
                    .call(xAxis_sc_m);
            svg_sc.append("g")
                    .attr("class", "axis")
                    //.attr('transform', 'translate(0,' + (y_scatter(0)) + ')')

                    .attr("transform", "translate(0," + height_l + ")")
                    //.attr("transform", "translate(" + margin.left + "," + margin.top + ")")
                    .call(xAxis_sc);
        //Create Y axis
            svg_sc.append("g")
                    .attr("class", "axis")

                .attr("transform", "translate(" + x_scatter(0) + ",0)")
                    .call(yAxis_sc_m);
              svg_sc.append("g")
                    .attr("class", "axis")

                  //.attr("transform", "translate(" + x_scatter(0) + ",0)")
                  //.attr("transform", "translate(" + margin.left + "," + margin.top + ")")
                    .call(yAxis_sc);
          // add the X gridlines
            svg_sc.append("g")
                .attr("class", "grid")
                .attr("transform", "translate(0," + height_l + ")")
                .call(make_x_gridlines_sc()
                    .tickSize(-height_l)
                    .tickFormat("")
                )
            // add the Y gridlines
            svg_sc.append("g")
                .attr("class", "grid")
                .call(make_y_gridlines_sc()
                    .tickSize(-width_l)
                    .tickFormat("")
                )

            // Add the title:
            svg_sc.append("text")
                .attr("x", (width_l / 2))
                .attr("y", -margin_l.top/2)
                .attr("text-anchor", "middle")
                .attr("class", "title")
                .style("font-size", 25*scale+"px")
                .style("font-family", "avenir next")
                .style("fill", "#696969")
                .style("font-weight", "bold")
                .text(title);
                        // Add the title:
              svg_sc.append("text")
                .attr("x", (width_l / 2))
                .attr("y", -margin_l.top/4)
                .attr("text-anchor", "middle")
                .attr("class", "title")
                .style("font-size", 14*scale+"px")
                .style("font-family", "avenir next")
                .style("fill", "#696969")
                .style("font-weight", "bold")
                .text(title2);

          /*
          svg_sc.append("text")
              .attr("x", width_l*.05-10)
                .attr("y", height_l+(50*scale))
                .attr("text-anchor", "start")
                .attr("class", "sttitle")
                .style("font-size", 20*scale+"px")
                .style("font-family", "Avenir")
                .style("fill", "black")
                .style("text-decoration", "underline")
                .text(linelegendtext);
            */
            /*
              // Add the State Legend:
              svg_sc.append("text")
                .attr("x", width_l*.05)
                .attr("y", height_l+(70*scale))
                .attr("text-anchor", "start")
                .attr("class", "legendst")
                .style("font-size", 20*scale+"px")
                .style("font-family", "Avenir")
                .style("fill", linecolor)
                .text(st);
              */
      // Add y-axis label

      svg_sc.append("text")
       .attr("transform", "rotate(-90)")
       .attr("x", 0 - height_l/2 )
        .attr("y", 0-margin_l.left/2 )
       //.attr("dy", "1em")
        .style("fill", 'black')
        .text(xAxisLabel)
        .attr("text-anchor", "middle")
        .style("alignment-baseline", "central")

            // Add x-axis label

      svg_sc.append("text")
      // .attr("transform", "rotate(-90)")
       .attr("x", width_l/2)
        .attr("y", height_l + margin_l.top/2)
       //.attr("dy", "1em")
        .style("fill", 'black')
        .text(yAxisLabel)
        .attr("text-anchor", "middle")
        .style("alignment-baseline", "central")
    // Legend

    updateLegendScatter (svg_sc, width_l*1.01,height_l/1.3)


  }
    function updateHeatmap(){
      var tilepadding = .5;
                    var svg_s = d3.select("#chart2")
                        .append("svg")
                        .attr("id","seasonal")
                        .attr("width", width_s + margin_s.left + margin_s.right)
                        .attr("height", height_s + margin_s.top + margin_s.bottom)
                        .append("g")
                    .attr("transform", "translate(" + margin_s.left + "," + margin_s.top + ")")
                        ;
                //var xAxis = d3.axisBottom().scale(x).ticks(5);
                var xAxis = d3.axisBottom()
                    .scale(x_heat)
                    //.ticks(d3.scaleTime.month, 2)
                    //.ticks(2)
                    .tickValues(x_heat.domain().filter(function(d, i) {return !(i%7);}))
                        .tickFormat(d3.timeFormat('%m/%d'))
                            .tickSizeOuter(0);
                  var xAxis_t = d3.axisTop()
                    .scale(x_heat)
                    //.ticks(d3.scaleTime.month, 2)
                    //.ticks(2)
                    .tickValues(x_heat.domain().filter(function(d, i) {return !(i%7);}))
                        .tickFormat(d3.timeFormat('%m/%d'))
                            .tickSizeOuter(0);
                    //var xAxisHandleForUpdate = svg_s.append("g")
                    svg_s.append("g")
                            .attr("class", "x axis")
                            .attr("transform", "translate(0," + height_s + ")")
                            .call(xAxis);
                    //var xAxisHandleForUpdate = svg_s.append("g")
                    svg_s.append("g")
                            .attr("class", "x axis top")
                            //.attr("transform", "translate(0," + height_s + ")")
                            .call(xAxis_t);
                    var yAxis = d3.axisLeft().scale(y_heat).tickSizeOuter(0);

                    //console.log (xt.domain())
                    // Render the data in an svg:

                    svg_s.selectAll("svg")
                        //.data(us_daily_case_data)
                        .data(heatmapdata)
                        .enter().append("rect")
                        .attr("class", "tile")
                        .attr("x", function(d) {return x_heat(parser4d(d.Date)); })
                        .attr("y", function(d) {return y_heat(d.Province_State); })
                        .attr("width", x_heat.bandwidth()-tilepadding)
                        .attr("height", y_heat.bandwidth()-tilepadding)
                        .attr("transform", "translate(0, 0)")
                        .style("fill",function(d)
                        {
                          //console.log(heatmaptype)

                          if  (heatmaptype == "trend") {
                           // console.log(d.Date, d.Province_State, d.value, heatmapScale(+d.value))
                           // return d3.interpolateOranges(heatmapScale(Math.log10(+d.value)));
                           //return d3.interpolateOranges(heatmapScale((+d.value)));
                           return d3.interpolateRdYlGn(1- heatmapScale((+d.value)));
                          }
                          else if (heatmaptype == 'dailycase'){
                            return d3.interpolateOranges(heatmapScale(Math.log10(+d.value)));
                          }
                        })
                       /* .on('mouseover', function(d){
                         // console.log(d)
                          d3.select(this)
                         // .style("fill", "b")
                          .style("stroke","black")
                          svg_s.append("text")
                            .attr("id", "tooltip")
                            .attr("x", width_s/2)
                            .attr("y", -margin_s.top/5)
                            .attr("text-anchor", "middle")
                            .attr("font-family", "sans-serif")
                            .attr("font-size", 15*scale+"px")
                            .attr("font-weight", "bold")
                            .attr("fill", "black")
                            .text(d.Province_State + " " + d.Date +" : " + d.value)
                            /*.text(function(d){
                              console.log(d)
                               if(heatmaptype == "dailycase"){
                                    return  d.value; //d.Date + " " + d.Province_State +" : " +
                                }

                            })

                           // console.log("***")

                        })*/
                        .on('mouseover',function(d){
                                d.type = 'heatmap'
                                d.fact = d.value
                                tip.show(d)

                                d3.select(this).transition().duration(300).style("opacity", 0.8);
                              })
                            .on('mouseout', function(d){
                                tip.hide(d)
                              d3.select(this).transition().duration(300).style("opacity", 1);
                                  }
                              )
                              .on('click',showstatetrend)
                   /* .on("mouseout", function(d) {
                        d3.select(this)
                        .transition()
                        .duration(250)
                        .style("stroke","none")
                        .style("fill", function(d) {

                            if(heatmaptype == "trend"){
                              //return d3.interpolateOranges(heatmapScale(Math.log10(+d.value)));
                              //return d3.interpolateOranges(heatmapScale((+d.value)));
                              return d3.interpolateRdYlGn(1- heatmapScale((+d.value)));
                            }
                            else if (heatmaptype == 'dailycase'){
                            return d3.interpolateOranges(heatmapScale(Math.log10(+d.value)));
                            }

                        })
                        d3.select("#tooltip").remove();
                    });*/
                // Add the title:
                svg_s.append("text")
                        .attr("x", (width_s / 2))
                        .attr("y", -margin_s.top/1.5)
                        .attr("text-anchor", "middle")
                        .attr("class", "title")
                        .style("font-size", 25*scale+"px")
                        .style("font-family", "avenir next")
                        .style("fill", "#696969")
                        .style("font-weight", "bold")
                        //.text("Seasonal Change for " + st +" - " + title);
                        .text(heatmaptitle);

                    // Add a y-axis with label
                svg_s.append("g")
                        .attr("class", "y axis")
                        .call(yAxis)
                        .append("text")
                        .attr("class", "label")
                        .attr("x", 4)
                    // .attr("dy", ".71em")
                        .attr("text-anchor", "end")
                        .attr("transform", "rotate(-90)")
                        .text("Value");

            //Legend
            var legendX_s = scale*margin_s.left/10,
                    legendY_s = height_s+(margin_s.bottom)/3;
                svg_s.append("text")
                    .attr("x", legendX_s)
                    .attr("y", legendY_s)
                    .attr("font-size",15*scale)
                    .attr("text-anchor", "start")
                    .attr("font-weight","bold")
                    //.text(String);
                    .text(s_legendtext);
                var legendUpdate = svg_s.selectAll("g.legend")
                    .data(heatmapScale.domain());
                var legendEnter = legendUpdate.enter().append("g")
                    .attr("class", "legend")
                    .attr("id",function(d){ return d})
                    .attr("transform", function(d, i) { return "translate(" + (legendX_s + i*50*scale) + "," + (legendY_s ) + ")"; });

                var legendExit = legendUpdate.exit();
                legendExit.remove()
                legendUpdate.merge(legendEnter)
                    .append("rect")
                    .attr("width", 50*scale)
                    .attr("height", 20*scale)
                    .style("fill", function(d){
                        if(heatmaptype == "trend"){
                        //console.log( d,heatmapScale(d),(1-heatmapScale(d)),d3.interpolateRdYlGn(1-heatmapScale(d)))
                           // return (d3.interpolateOranges(heatmapScale(d)))
                           return d3.interpolateRdYlGn(1 - heatmapScale(d));

                        }
                        else if (heatmaptype == 'dailycase'){
                         // console.log(heatmapScale(d))
                            return d3.interpolateOranges(heatmapScale((d)));
                            }
                        });
                legendUpdate.merge(legendEnter)
                    .append("text")
                    .attr("x", 0)
                    .attr("y", 27*scale)
                    .attr("dy", ".35em")
                    .attr("font-size",14*scale)
                    .attr("text-anchor", "start")
                    //.text(String);
                    //.text(function(d){ return Math.pow(10,d)});
                    .text(function(d){
                        if (heatmaptype=='trend'){
                          return d
                        }
                        else if (heatmaptype == 'dailycase'){
                          return Math.pow(10,d)
                        }
                      });

    }


    //<<<<<<<<<<<<End of Ready functions
}
</script>


</body>
